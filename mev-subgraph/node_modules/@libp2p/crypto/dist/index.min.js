(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PCrypto = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PCrypto=(()=>{var tn=Object.defineProperty;var zi=Object.getOwnPropertyDescriptor;var Fi=Object.getOwnPropertyNames;var ji=Object.prototype.hasOwnProperty;var et=(e,t)=>{for(var r in t)tn(e,r,{get:t[r],enumerable:!0})},Gi=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Fi(t))!ji.call(e,o)&&o!==r&&tn(e,o,{get:()=>t[o],enumerable:!(n=zi(t,o))||n.enumerable});return e};var Zi=e=>Gi(tn({},"__esModule",{value:!0}),e);var Of={};et(Of,{hmac:()=>mr,keys:()=>Ao,pbkdf2:()=>So,randomBytes:()=>ao});var mr={};et(mr,{create:()=>en});var He=class extends Error{constructor(t="An error occurred while signing a message"){super(t),this.name="SigningError"}},Oe=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},pr=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var Bo={get(e=globalThis){let t=e.crypto;if(t?.subtle==null)throw new pr("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var F=Bo;var vo={SHA1:20,SHA256:32,SHA512:64};var $i={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},Yi=async(e,t)=>{let r=await F.get().subtle.sign({name:"HMAC"},e,t);return new Uint8Array(r,0,r.byteLength)};async function en(e,t){let r=$i[e],n=await F.get().subtle.importKey("raw",t,{name:"HMAC",hash:{name:r}},!1,["sign"]);return{async digest(o){return Yi(n,o)},length:vo[e]}}var Ao={};et(Ao,{generateEphemeralKeyPair:()=>Ri,generateKeyPair:()=>vf,generateKeyPairFromSeed:()=>If,keyStretcher:()=>ki,privateKeyFromCryptoKeyPair:()=>Nf,privateKeyFromProtobuf:()=>Tf,privateKeyFromRaw:()=>Uf,privateKeyToCryptoKeyPair:()=>Rf,privateKeyToProtobuf:()=>Cf,publicKeyFromMultihash:()=>Lf,publicKeyFromProtobuf:()=>_f,publicKeyFromRaw:()=>Kf,publicKeyToProtobuf:()=>Wt});var N=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},he=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}},Me=class extends Error{static name="InvalidPrivateKeyError";constructor(t="Invalid private key"){super(t),this.name="InvalidPrivateKeyError"}};var Nt=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var an={};et(an,{base58btc:()=>W,base58flickr:()=>ra});var Wf=new Uint8Array(0);function Io(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function Kt(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function _o(e){return new TextEncoder().encode(e)}function Ko(e){return new TextDecoder().decode(e)}function Wi(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var s=e.charAt(o),i=s.charCodeAt(0);if(r[i]!==255)throw new TypeError(s+" is ambiguous");r[i]=o}var a=e.length,c=e.charAt(0),h=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function u(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var E=0,y=0,S=0,I=g.length;S!==I&&g[S]===0;)S++,E++;for(var B=(I-S)*f+1>>>0,C=new Uint8Array(B);S!==I;){for(var p=g[S],U=0,T=B-1;(p!==0||U<y)&&T!==-1;T--,U++)p+=256*C[T]>>>0,C[T]=p%a>>>0,p=p/a>>>0;if(p!==0)throw new Error("Non-zero carry");y=U,S++}for(var _=B-y;_!==B&&C[_]===0;)_++;for(var l=c.repeat(E);_<B;++_)l+=e.charAt(C[_]);return l}function m(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var E=0;if(g[E]!==" "){for(var y=0,S=0;g[E]===c;)y++,E++;for(var I=(g.length-E)*h+1>>>0,B=new Uint8Array(I);g[E];){var C=r[g.charCodeAt(E)];if(C===255)return;for(var p=0,U=I-1;(C!==0||p<S)&&U!==-1;U--,p++)C+=a*B[U]>>>0,B[U]=C%256>>>0,C=C/256>>>0;if(C!==0)throw new Error("Non-zero carry");S=p,E++}if(g[E]!==" "){for(var T=I-S;T!==I&&B[T]===0;)T++;for(var _=new Uint8Array(y+(I-T)),l=y;T!==I;)_[l++]=B[T++];return _}}}function b(g){var E=m(g);if(E)return E;throw new Error(`Non-${t} character`)}return{encode:u,decodeUnsafe:m,decode:b}}var Xi=Wi,Ji=Xi,To=Ji;var rn=class{name;prefix;baseEncode;constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},nn=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,r,n){this.name=t,this.prefix=r;let o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Uo(this,t)}},on=class{decoders;constructor(t){this.decoders=t}or(t){return Uo(this,t)}decode(t){let r=t[0],n=this.decoders[r];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Uo(e,t){return new on({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}var sn=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new rn(t,r,n),this.decoder=new nn(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function le({name:e,prefix:t,encode:r,decode:n}){return new sn(e,t,r,n)}function kt({name:e,prefix:t,alphabet:r}){let{encode:n,decode:o}=To(r,e);return le({prefix:t,name:e,encode:n,decode:s=>Kt(o(s))})}function Qi(e,t,r,n){let o=e.length;for(;e[o-1]==="=";)--o;let s=new Uint8Array(o*r/8|0),i=0,a=0,c=0;for(let h=0;h<o;++h){let f=t[e[h]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);a=a<<r|f,i+=r,i>=8&&(i-=8,s[c++]=255&a>>i)}if(i>=r||(255&a<<8-i)!==0)throw new SyntaxError("Unexpected end of data");return s}function ta(e,t,r){let n=t[t.length-1]==="=",o=(1<<r)-1,s="",i=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],i+=8;i>r;)i-=r,s+=t[o&a>>i];if(i!==0&&(s+=t[o&a<<r-i]),n)for(;(s.length*r&7)!==0;)s+="=";return s}function ea(e){let t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}function G({name:e,prefix:t,bitsPerChar:r,alphabet:n}){let o=ea(n);return le({prefix:t,name:e,encode(s){return ta(s,n,r)},decode(s){return Qi(s,o,r,e)}})}var W=kt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ra=kt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var cn={};et(cn,{base32:()=>de,base32hex:()=>ia,base32hexpad:()=>ca,base32hexpadupper:()=>fa,base32hexupper:()=>aa,base32pad:()=>oa,base32padupper:()=>sa,base32upper:()=>na,base32z:()=>ua});var de=G({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),na=G({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),oa=G({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),sa=G({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ia=G({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),aa=G({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ca=G({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),fa=G({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ua=G({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var fn={};et(fn,{base36:()=>qe,base36upper:()=>ha});var qe=kt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ha=kt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var la=Po,Co=128,da=127,pa=~da,ma=Math.pow(2,31);function Po(e,t,r){t=t||[],r=r||0;for(var n=r;e>=ma;)t[r++]=e&255|Co,e/=128;for(;e&pa;)t[r++]=e&255|Co,e>>>=7;return t[r]=e|0,Po.bytes=r-n+1,t}var ya=un,ba=128,Do=127;function un(e,n){var r=0,n=n||0,o=0,s=n,i,a=e.length;do{if(s>=a)throw un.bytes=0,new RangeError("Could not decode varint");i=e[s++],r+=o<28?(i&Do)<<o:(i&Do)*Math.pow(2,o),o+=7}while(i>=ba);return un.bytes=s-n,r}var xa=Math.pow(2,7),wa=Math.pow(2,14),ga=Math.pow(2,21),Ea=Math.pow(2,28),Aa=Math.pow(2,35),Sa=Math.pow(2,42),Ba=Math.pow(2,49),va=Math.pow(2,56),Ia=Math.pow(2,63),_a=function(e){return e<xa?1:e<wa?2:e<ga?3:e<Ea?4:e<Aa?5:e<Sa?6:e<Ba?7:e<va?8:e<Ia?9:10},Ka={encode:la,decode:ya,encodingLength:_a},La=Ka,Ve=La;function ze(e,t=0){return[Ve.decode(e,t),Ve.decode.bytes]}function pe(e,t,r=0){return Ve.encode(e,t,r),t}function me(e){return Ve.encodingLength(e)}function bt(e,t){let r=t.byteLength,n=me(e),o=n+me(r),s=new Uint8Array(o+r);return pe(e,s,0),pe(r,s,n),s.set(t,o),new ye(e,r,t,s)}function Ro(e){let t=Kt(e),[r,n]=ze(t),[o,s]=ze(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new ye(r,o,i,t)}function No(e,t){if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&Io(e.bytes,r.bytes)}}var ye=class{code;size;digest;bytes;constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}};function ko(e,t){let{bytes:r,version:n}=e;switch(n){case 0:return Ua(r,hn(e),t??W.encoder);default:return Ca(r,hn(e),t??de.encoder)}}var Ho=new WeakMap;function hn(e){let t=Ho.get(e);if(t==null){let r=new Map;return Ho.set(e,r),r}return t}var yt=class e{code;version;multihash;bytes;"/";constructor(t,r,n,o){this.code=r,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==je)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Da)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=bt(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(t,r){let n=r;return n!=null&&t.code===n.code&&t.version===n.version&&No(t.multihash,n.multihash)}toString(t){return ko(this,t)}toJSON(){return{"/":ko(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof e)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:s,bytes:i}=r;return new e(n,o,s,i??Oo(n,o,s.bytes))}else if(r[Pa]===!0){let{version:n,multihash:o,code:s}=r,i=Ro(o);return e.create(n,s,i)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==je)throw new Error(`Version 0 CID must use dag-pb (code: ${je}) block encoding`);return new e(t,r,n,n.bytes)}case 1:{let o=Oo(t,r,n.bytes);return new e(t,r,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,je,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){let[r,n]=e.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=e.inspectBytes(t),n=r.size-r.multihashSize,o=Kt(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=o.subarray(r.multihashSize-r.digestSize),i=new ye(r.multihashCode,r.digestSize,s,o);return[r.version===0?e.createV0(i):e.createV1(r.codec,i),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[u,m]=ze(t.subarray(r));return r+=m,u},o=n(),s=je;if(o===18?(o=0,r=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=r,a=n(),c=n(),h=r+c,f=h-i;return{version:o,codec:s,multihashCode:a,digestSize:c,multihashSize:f,size:h}}static parse(t,r){let[n,o]=Ta(t,r),s=e.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return hn(s).set(n,t),s}};function Ta(e,t){switch(e[0]){case"Q":{let r=t??W;return[W.prefix,r.decode(`${W.prefix}${e}`)]}case W.prefix:{let r=t??W;return[W.prefix,r.decode(e)]}case de.prefix:{let r=t??de;return[de.prefix,r.decode(e)]}case qe.prefix:{let r=t??qe;return[qe.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}}function Ua(e,t,r){let{prefix:n}=r;if(n!==W.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=t.get(n);if(o==null){let s=r.encode(e).slice(1);return t.set(n,s),s}else return o}function Ca(e,t,r){let{prefix:n}=r,o=t.get(n);if(o==null){let s=r.encode(e);return t.set(n,s),s}else return o}var je=112,Da=18;function Oo(e,t,r){let n=me(e),o=n+me(t),s=new Uint8Array(o+r.byteLength);return pe(e,s,0),pe(t,s,n),s.set(r,o),s}var Pa=Symbol.for("@ipld/js-cid/CID");var ln={};et(ln,{identity:()=>$t});var Mo=0,Ra="identity",qo=Kt;function Na(e){return bt(Mo,qo(e))}var $t={code:Mo,name:Ra,encode:qo,digest:Na};function rt(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function Lt(e=0){return new Uint8Array(e)}function ht(e=0){return new Uint8Array(e)}function St(e,t){t==null&&(t=e.reduce((o,s)=>o+s.length,0));let r=ht(t),n=0;for(let o of e)r.set(o,n),n+=o.length;return r}var zo=Symbol.for("@achingbrain/uint8arraylist");function Vo(e,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let r=0;for(let n of e){let o=r+n.byteLength;if(t<o)return{buf:n,index:t-r};r=o}throw new RangeError("index is out of bounds")}function br(e){return!!e?.[zo]}var st=class e{bufs;length;[zo]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let r=0;for(let n of t)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(br(n))r+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}prepend(...t){this.prependAll(t)}prependAll(t){let r=0;for(let n of t.reverse())if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.unshift(n);else if(br(n))r+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(t){let r=Vo(this.bufs,t);return r.buf[r.index]}set(t,r){let n=Vo(this.bufs,t);n.buf[n.index]=r}write(t,r=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(r+n,t[n]);else if(br(t))for(let n=0;n<t.length;n++)this.set(r+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,r){let{bufs:n,length:o}=this._subList(t,r);return St(n,o)}subarray(t,r){let{bufs:n,length:o}=this._subList(t,r);return n.length===1?n[0]:St(n,o)}sublist(t,r){let{bufs:n,length:o}=this._subList(t,r),s=new e;return s.length=o,s.bufs=[...n],s}_subList(t,r){if(t=t??0,r=r??this.length,t<0&&(t=this.length+t),r<0&&(r=this.length+r),t<0||r>this.length)throw new RangeError("index is out of bounds");if(t===r)return{bufs:[],length:0};if(t===0&&r===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],a=o,c=a+i.byteLength;if(o=c,t>=c)continue;let h=t>=a&&t<c,f=r>a&&r<=c;if(h&&f){if(t===a&&r===c){n.push(i);break}let u=t-a;n.push(i.subarray(u,u+(r-t)));break}if(h){if(t===0){n.push(i);continue}n.push(i.subarray(t-a));continue}if(f){if(r===c){n.push(i);break}n.push(i.subarray(0,r-a));break}n.push(i)}return{bufs:n,length:r-t}}indexOf(t,r=0){if(!br(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(r=Number(r??0),isNaN(r)&&(r=0),r<0&&(r=this.length+r),r<0&&(r=0),t.length===0)return r>this.length?this.length:r;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let u=0;u<s;u++)i[u]=-1;for(let u=0;u<o;u++)i[n[u]]=u;let a=i,c=this.byteLength-n.byteLength,h=n.byteLength-1,f;for(let u=r;u<=c;u+=f){f=0;for(let m=h;m>=0;m--){let b=this.get(u+m);if(n[m]!==b){f=Math.max(1,m-a[b]);break}}if(f===0)return u}return-1}getInt8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(t,r){let n=ht(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,t)}getInt16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(t,r,n){let o=Lt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,r,n),this.write(o,t)}getInt32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(t,r,n){let o=Lt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,r,n),this.write(o,t)}getBigInt64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(t,r,n){let o=Lt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,r,n),this.write(o,t)}getUint8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(t,r){let n=ht(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,t)}getUint16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(t,r,n){let o=Lt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,r,n),this.write(o,t)}getUint32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(t,r,n){let o=Lt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,r,n),this.write(o,t)}getBigUint64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(t,r,n){let o=Lt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,r,n),this.write(o,t)}getFloat32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(t,r,n){let o=Lt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,r,n),this.write(o,t)}getFloat64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(t,r,n){let o=Lt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,r,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof e)||t.bufs.length!==this.bufs.length)return!1;for(let r=0;r<this.bufs.length;r++)if(!rt(this.bufs[r],t.bufs[r]))return!1;return!0}static fromUint8Arrays(t,r){let n=new e;return n.bufs=t,r==null&&(r=t.reduce((o,s)=>o+s.byteLength,0)),n.length=r,n}};var dn={};et(dn,{base10:()=>ka});var ka=kt({prefix:"9",name:"base10",alphabet:"0123456789"});var pn={};et(pn,{base16:()=>Ha,base16upper:()=>Oa});var Ha=G({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Oa=G({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var mn={};et(mn,{base2:()=>Ma});var Ma=G({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var yn={};et(yn,{base256emoji:()=>ja});var Fo=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),qa=Fo.reduce((e,t,r)=>(e[r]=t,e),[]),Va=Fo.reduce((e,t,r)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return e[n]=r,e},[]);function za(e){return e.reduce((t,r)=>(t+=qa[r],t),"")}function Fa(e){let t=[];for(let r of e){let n=r.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${r}`);let o=Va[n];if(o==null)throw new Error(`Non-base256emoji character: ${r}`);t.push(o)}return new Uint8Array(t)}var ja=le({prefix:"\u{1F680}",name:"base256emoji",encode:za,decode:Fa});var xn={};et(xn,{base64:()=>bn,base64pad:()=>Ga,base64url:()=>Za,base64urlpad:()=>$a});var bn=G({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ga=G({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Za=G({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$a=G({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var wn={};et(wn,{base8:()=>Ya});var Ya=G({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var gn={};et(gn,{identity:()=>Wa});var Wa=le({prefix:"\0",name:"identity",encode:e=>Ko(e),decode:e=>_o(e)});var Du=new TextEncoder,Pu=new TextDecoder;var Sn={};et(Sn,{sha256:()=>xr,sha512:()=>Qa});function An({name:e,code:t,encode:r}){return new En(e,t,r)}var En=class{name;code;encode;constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){let r=this.encode(t);return r instanceof Uint8Array?bt(this.code,r):r.then(n=>bt(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Go(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}var xr=An({name:"sha2-256",code:18,encode:Go("SHA-256")}),Qa=An({name:"sha2-512",code:19,encode:Go("SHA-512")});var Bn={...gn,...mn,...wn,...dn,...pn,...cn,...fn,...an,...xn,...yn},Gu={...Sn,...ln};function $o(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var Zo=$o("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),vn=$o("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=ht(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),tc={utf8:Zo,"utf-8":Zo,hex:Bn.base16,latin1:vn,ascii:vn,binary:vn,...Bn},wr=tc;function q(e,t="utf8"){let r=wr[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}function k(e,t="utf8"){let r=wr[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}var ec=parseInt("11111",2),In=parseInt("10000000",2),rc=parseInt("01111111",2),Yo={0:Ge,1:Ge,2:nc,3:ic,4:ac,5:sc,6:oc,16:Ge,22:Ge,48:Ge};function lt(e,t={offset:0}){let r=e[t.offset]&ec;if(t.offset++,Yo[r]!=null)return Yo[r](e,t);throw new Error("No decoder for tag "+r)}function Ze(e,t){let r=0;if((e[t.offset]&In)===In){let n=e[t.offset]&rc,o="0x";t.offset++;for(let s=0;s<n;s++,t.offset++)o+=e[t.offset].toString(16).padStart(2,"0");r=parseInt(o,16)}else r=e[t.offset],t.offset++;return r}function Ge(e,t){Ze(e,t);let r=[];for(;!(t.offset>=e.byteLength);){let n=lt(e,t);if(n===null)break;r.push(n)}return r}function nc(e,t){let r=Ze(e,t),n=t.offset,o=t.offset+r,s=[];for(let i=n;i<o;i++)i===n&&e[i]===0||s.push(e[i]);return t.offset+=r,Uint8Array.from(s)}function oc(e,t){let r=Ze(e,t),n=t.offset+r,o=e[t.offset];t.offset++;let s=0,i=0;o<40?(s=0,i=o):o<80?(s=1,i=o-40):(s=2,i=o-80);let a=`${s}.${i}`,c=[];for(;t.offset<n;){let h=e[t.offset];if(t.offset++,c.push(h&127),h<128){c.reverse();let f=0;for(let u=0;u<c.length;u++)f+=c[u]<<u*7;a+=`.${f}`,c=[]}}return a}function sc(e,t){return t.offset++,null}function ic(e,t){let r=Ze(e,t),n=e[t.offset];t.offset++;let o=e.subarray(t.offset,t.offset+r-1);if(t.offset+=r,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function ac(e,t){let r=Ze(e,t),n=e.subarray(t.offset,t.offset+r);return t.offset+=r,n}function cc(e){let t=e.toString(16);t.length%2===1&&(t="0"+t);let r=new st;for(let n=0;n<t.length;n+=2)r.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return r}function gr(e){if(e.byteLength<128)return Uint8Array.from([e.byteLength]);let t=cc(e.byteLength);return new st(Uint8Array.from([t.byteLength|In]),t)}function it(e){let t=new st,r=128;return(e.subarray()[0]&r)===r&&t.append(Uint8Array.from([0])),t.append(e),new st(Uint8Array.from([2]),gr(t),t)}function $e(e){let t=Uint8Array.from([0]),r=new st(t,e);return new st(Uint8Array.from([3]),gr(r),r)}function Wo(e){return new st(Uint8Array.from([4]),gr(e),e)}function xt(e,t=48){let r=new st;for(let n of e)r.append(n);return new st(Uint8Array.from([t]),gr(r),r)}var _n="1.2.840.10045.3.1.7",Kn="1.3.132.0.34",Ln="1.3.132.0.35";async function Xo(e="P-256"){let t=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:e},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",t.publicKey),privateKey:await crypto.subtle.exportKey("jwk",t.privateKey)}}async function Jo(e,t,r){let n=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["sign"]);r?.signal?.throwIfAborted();let o=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function Qo(e,t,r,n){let o=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();let s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,t,r.subarray());return n?.signal?.throwIfAborted(),s}var fc=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),uc=Uint8Array.from([6,5,43,129,4,0,34]),hc=Uint8Array.from([6,5,43,129,4,0,35]),ts={ext:!0,kty:"EC",crv:"P-256"},es={ext:!0,kty:"EC",crv:"P-384"},rs={ext:!0,kty:"EC",crv:"P-521"},be=32,xe=48,we=66;function ns(e){let t=lt(e);return Tn(t)}function Tn(e){let t=e[1],r=k(t,"base64url"),n=e[2][1][0],o=1,s,i;if(t.byteLength===be)return s=k(n.subarray(o,o+be),"base64url"),i=k(n.subarray(o+be),"base64url"),new Tt({...ts,key_ops:["sign"],d:r,x:s,y:i});if(t.byteLength===xe)return s=k(n.subarray(o,o+xe),"base64url"),i=k(n.subarray(o+xe),"base64url"),new Tt({...es,key_ops:["sign"],d:r,x:s,y:i});if(t.byteLength===we)return s=k(n.subarray(o,o+we),"base64url"),i=k(n.subarray(o+we),"base64url"),new Tt({...rs,key_ops:["sign"],d:r,x:s,y:i});throw new N(`Private key length was wrong length, got ${t.byteLength}, expected 32, 48 or 66`)}function Un(e){let t=lt(e);return Cn(t)}function Cn(e){let t=e[1][1][0],r=1,n,o;if(t.byteLength===be*2+1)return n=k(t.subarray(r,r+be),"base64url"),o=k(t.subarray(r+be),"base64url"),new Yt({...ts,key_ops:["verify"],x:n,y:o});if(t.byteLength===xe*2+1)return n=k(t.subarray(r,r+xe),"base64url"),o=k(t.subarray(r+xe),"base64url"),new Yt({...es,key_ops:["verify"],x:n,y:o});if(t.byteLength===we*2+1)return n=k(t.subarray(r,r+we),"base64url"),o=k(t.subarray(r+we),"base64url"),new Yt({...rs,key_ops:["verify"],x:n,y:o});throw new N(`coordinates were wrong length, got ${t.byteLength}, expected 65, 97 or 133`)}function os(e){return xt([it(Uint8Array.from([1])),Wo(q(e.d??"","base64url")),xt([is(e.crv)],160),xt([$e(new st(Uint8Array.from([4]),q(e.x??"","base64url"),q(e.y??"","base64url")))],161)]).subarray()}function ss(e){return xt([it(Uint8Array.from([1])),xt([is(e.crv)],160),xt([$e(new st(Uint8Array.from([4]),q(e.x??"","base64url"),q(e.y??"","base64url")))],161)]).subarray()}function is(e){if(e==="P-256")return fc;if(e==="P-384")return uc;if(e==="P-521")return hc;throw new N(`Invalid curve ${e}`)}async function as(e="P-256"){let t=await Xo(e);return new Tt(t.privateKey)}var Yt=class{type="ECDSA";jwk;_raw;constructor(t){this.jwk=t}get raw(){return this._raw==null&&(this._raw=ss(this.jwk)),this._raw}toMultihash(){return $t.digest(Wt(this))}toCID(){return yt.createV1(114,this.toMultihash())}toString(){return W.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:rt(this.raw,t.raw)}async verify(t,r,n){return Qo(this.jwk,r,t,n)}},Tt=class{type="ECDSA";jwk;publicKey;_raw;constructor(t){this.jwk=t,this.publicKey=new Yt({crv:t.crv,ext:t.ext,key_ops:["verify"],kty:"EC",x:t.x,y:t.y})}get raw(){return this._raw==null&&(this._raw=os(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:rt(this.raw,t.raw)}async sign(t,r){return Jo(this.jwk,t,r)}};var Xt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Ee(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Ct(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function J(e,...t){if(!Ee(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Er(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Ct(e.outputLen),Ct(e.blockLen)}function Ae(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function fs(e,t){J(e);let r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function ut(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function Se(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function wt(e,t){return e<<32-t|e>>>t}function Ar(e,t){return e<<t|e>>>32-t>>>0}var us=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",lc=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Bt(e){if(J(e),us)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=lc[e[r]];return t}var Ut={_0:48,_9:57,A:65,F:70,a:97,f:102};function cs(e){if(e>=Ut._0&&e<=Ut._9)return e-Ut._0;if(e>=Ut.A&&e<=Ut.F)return e-(Ut.A-10);if(e>=Ut.a&&e<=Ut.f)return e-(Ut.a-10)}function Be(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(us)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){let i=cs(e.charCodeAt(s)),a=cs(e.charCodeAt(s+1));if(i===void 0||a===void 0){let c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[o]=i*16+a}return n}function Dn(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function Ye(e){return typeof e=="string"&&(e=Dn(e)),J(e),e}function Pn(e){return typeof e=="string"&&(e=Dn(e)),J(e),e}function dt(...e){let t=0;for(let n=0;n<e.length;n++){let o=e[n];J(o),t+=o.length}let r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){let s=e[n];r.set(s,o),o+=s.length}return r}function hs(e,t){if(t!==void 0&&{}.toString.call(t)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(e,t)}var ge=class{};function We(e){let t=n=>e().update(Ye(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function Jt(e=32){if(Xt&&typeof Xt.getRandomValues=="function")return Xt.getRandomValues(new Uint8Array(e));if(Xt&&typeof Xt.randomBytes=="function")return Uint8Array.from(Xt.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function dc(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),a=Number(r&s),c=n?4:0,h=n?0:4;e.setUint32(t+c,i,n),e.setUint32(t+h,a,n)}function Sr(e,t,r){return e&t^~e&r}function Br(e,t,r){return e&t^e&r^t&r}var Qt=class extends ge{constructor(t,r,n,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=Se(this.buffer)}update(t){Ae(this),t=Ye(t),J(t);let{view:r,buffer:n,blockLen:o}=this,s=t.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=Se(t);for(;o<=s-i;i+=o)this.process(c,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Ae(this),fs(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,ut(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let u=i;u<o;u++)r[u]=0;dc(n,o-8,BigInt(this.length*8),s),this.process(n,0);let a=Se(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let h=c/4,f=this.get();if(h>f.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<h;u++)a.setUint32(4*u,f[u],s)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:a}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=a,o%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}},Dt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var Q=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var vr=BigInt(4294967295),ls=BigInt(32);function pc(e,t=!1){return t?{h:Number(e&vr),l:Number(e>>ls&vr)}:{h:Number(e>>ls&vr)|0,l:Number(e&vr)|0}}function ds(e,t=!1){let r=e.length,n=new Uint32Array(r),o=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:a}=pc(e[s],t);[n[s],o[s]]=[i,a]}return[n,o]}var Rn=(e,t,r)=>e>>>r,Nn=(e,t,r)=>e<<32-r|t>>>r,te=(e,t,r)=>e>>>r|t<<32-r,ee=(e,t,r)=>e<<32-r|t>>>r,Xe=(e,t,r)=>e<<64-r|t>>>r-32,Je=(e,t,r)=>e>>>r-32|t<<64-r;function vt(e,t,r,n){let o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:o|0}}var ps=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),ms=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,ys=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),bs=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0,xs=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),ws=(e,t,r,n,o,s)=>t+r+n+o+s+(e/2**32|0)|0;var yc=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ht=new Uint32Array(64),Ir=class extends Qt{constructor(t=32){super(64,t,8,!1),this.A=Dt[0]|0,this.B=Dt[1]|0,this.C=Dt[2]|0,this.D=Dt[3]|0,this.E=Dt[4]|0,this.F=Dt[5]|0,this.G=Dt[6]|0,this.H=Dt[7]|0}get(){let{A:t,B:r,C:n,D:o,E:s,F:i,G:a,H:c}=this;return[t,r,n,o,s,i,a,c]}set(t,r,n,o,s,i,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,r){for(let u=0;u<16;u++,r+=4)Ht[u]=t.getUint32(r,!1);for(let u=16;u<64;u++){let m=Ht[u-15],b=Ht[u-2],g=wt(m,7)^wt(m,18)^m>>>3,E=wt(b,17)^wt(b,19)^b>>>10;Ht[u]=E+Ht[u-7]+g+Ht[u-16]|0}let{A:n,B:o,C:s,D:i,E:a,F:c,G:h,H:f}=this;for(let u=0;u<64;u++){let m=wt(a,6)^wt(a,11)^wt(a,25),b=f+m+Sr(a,c,h)+yc[u]+Ht[u]|0,E=(wt(n,2)^wt(n,13)^wt(n,22))+Br(n,o,s)|0;f=h,h=c,c=a,a=i+b|0,i=s,s=o,o=n,n=b+E|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,h=h+this.G|0,f=f+this.H|0,this.set(n,o,s,i,a,c,h,f)}roundClean(){ut(Ht)}destroy(){this.set(0,0,0,0,0,0,0,0),ut(this.buffer)}};var gs=ds(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),bc=gs[0],xc=gs[1],Ot=new Uint32Array(80),Mt=new Uint32Array(80),_r=class extends Qt{constructor(t=64){super(128,t,16,!1),this.Ah=Q[0]|0,this.Al=Q[1]|0,this.Bh=Q[2]|0,this.Bl=Q[3]|0,this.Ch=Q[4]|0,this.Cl=Q[5]|0,this.Dh=Q[6]|0,this.Dl=Q[7]|0,this.Eh=Q[8]|0,this.El=Q[9]|0,this.Fh=Q[10]|0,this.Fl=Q[11]|0,this.Gh=Q[12]|0,this.Gl=Q[13]|0,this.Hh=Q[14]|0,this.Hl=Q[15]|0}get(){let{Ah:t,Al:r,Bh:n,Bl:o,Ch:s,Cl:i,Dh:a,Dl:c,Eh:h,El:f,Fh:u,Fl:m,Gh:b,Gl:g,Hh:E,Hl:y}=this;return[t,r,n,o,s,i,a,c,h,f,u,m,b,g,E,y]}set(t,r,n,o,s,i,a,c,h,f,u,m,b,g,E,y){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=a|0,this.Dl=c|0,this.Eh=h|0,this.El=f|0,this.Fh=u|0,this.Fl=m|0,this.Gh=b|0,this.Gl=g|0,this.Hh=E|0,this.Hl=y|0}process(t,r){for(let B=0;B<16;B++,r+=4)Ot[B]=t.getUint32(r),Mt[B]=t.getUint32(r+=4);for(let B=16;B<80;B++){let C=Ot[B-15]|0,p=Mt[B-15]|0,U=te(C,p,1)^te(C,p,8)^Rn(C,p,7),T=ee(C,p,1)^ee(C,p,8)^Nn(C,p,7),_=Ot[B-2]|0,l=Mt[B-2]|0,w=te(_,l,19)^Xe(_,l,61)^Rn(_,l,6),d=ee(_,l,19)^Je(_,l,61)^Nn(_,l,6),x=ys(T,d,Mt[B-7],Mt[B-16]),A=bs(x,U,w,Ot[B-7],Ot[B-16]);Ot[B]=A|0,Mt[B]=x|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:a,Cl:c,Dh:h,Dl:f,Eh:u,El:m,Fh:b,Fl:g,Gh:E,Gl:y,Hh:S,Hl:I}=this;for(let B=0;B<80;B++){let C=te(u,m,14)^te(u,m,18)^Xe(u,m,41),p=ee(u,m,14)^ee(u,m,18)^Je(u,m,41),U=u&b^~u&E,T=m&g^~m&y,_=xs(I,p,T,xc[B],Mt[B]),l=ws(_,S,C,U,bc[B],Ot[B]),w=_|0,d=te(n,o,28)^Xe(n,o,34)^Xe(n,o,39),x=ee(n,o,28)^Je(n,o,34)^Je(n,o,39),A=n&s^n&a^s&a,K=o&i^o&c^i&c;S=E|0,I=y|0,E=b|0,y=g|0,b=u|0,g=m|0,{h:u,l:m}=vt(h|0,f|0,l|0,w|0),h=a|0,f=c|0,a=s|0,c=i|0,s=n|0,i=o|0;let v=ps(w,x,K);n=ms(v,l,d,A),o=v|0}({h:n,l:o}=vt(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=vt(this.Bh|0,this.Bl|0,s|0,i|0),{h:a,l:c}=vt(this.Ch|0,this.Cl|0,a|0,c|0),{h,l:f}=vt(this.Dh|0,this.Dl|0,h|0,f|0),{h:u,l:m}=vt(this.Eh|0,this.El|0,u|0,m|0),{h:b,l:g}=vt(this.Fh|0,this.Fl|0,b|0,g|0),{h:E,l:y}=vt(this.Gh|0,this.Gl|0,E|0,y|0),{h:S,l:I}=vt(this.Hh|0,this.Hl|0,S|0,I|0),this.set(n,o,s,i,a,c,h,f,u,m,b,g,E,y,S,I)}roundClean(){ut(Ot,Mt)}destroy(){ut(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var Kr=We(()=>new Ir);var Lr=We(()=>new _r);var On=BigInt(0),Hn=BigInt(1);function Pt(e,t){if(typeof t!="boolean")throw new Error(e+" boolean expected, got "+t)}function Qe(e){let t=e.toString(16);return t.length&1?"0"+t:t}function Es(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?On:BigInt("0x"+e)}function ve(e){return Es(Bt(e))}function re(e){return J(e),Es(Bt(Uint8Array.from(e).reverse()))}function Tr(e,t){return Be(e.toString(16).padStart(t*2,"0"))}function Ie(e,t){return Tr(e,t).reverse()}function V(e,t,r){let n;if(typeof t=="string")try{n=Be(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(Ee(t))n=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");let o=n.length;if(typeof r=="number"&&o!==r)throw new Error(e+" of length "+r+" expected, got "+o);return n}var kn=e=>typeof e=="bigint"&&On<=e;function As(e,t,r){return kn(e)&&kn(t)&&kn(r)&&t<=e&&e<r}function qt(e,t,r,n){if(!As(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function Ss(e){let t;for(t=0;e>On;e>>=Hn,t+=1);return t}var ne=e=>(Hn<<BigInt(e))-Hn;function Bs(e,t,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=b=>new Uint8Array(b),o=b=>Uint8Array.of(b),s=n(e),i=n(e),a=0,c=()=>{s.fill(1),i.fill(0),a=0},h=(...b)=>r(i,s,...b),f=(b=n(0))=>{i=h(o(0),b),s=h(),b.length!==0&&(i=h(o(1),b),s=h())},u=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let b=0,g=[];for(;b<t;){s=h();let E=s.slice();g.push(E),b+=s.length}return dt(...g)};return(b,g)=>{c(),f(b);let E;for(;!(E=g(u()));)f();return c(),E}}function Vt(e,t,r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(o,s,i){let a=e[o];if(i&&a===void 0)return;let c=typeof a;if(c!==s||a===null)throw new Error(`param "${o}" is invalid: expected ${s}, got ${c}`)}Object.entries(t).forEach(([o,s])=>n(o,s,!1)),Object.entries(r).forEach(([o,s])=>n(o,s,!0))}function _e(e){let t=new WeakMap;return(r,...n)=>{let o=t.get(r);if(o!==void 0)return o;let s=e(r,...n);return t.set(r,s),s}}var at=BigInt(0),X=BigInt(1),oe=BigInt(2),wc=BigInt(3),_s=BigInt(4),Ks=BigInt(5),Ls=BigInt(8);function j(e,t){let r=e%t;return r>=at?r:t+r}function z(e,t,r){let n=e;for(;t-- >at;)n*=n,n%=r;return n}function vs(e,t){if(e===at)throw new Error("invert: expected non-zero number");if(t<=at)throw new Error("invert: expected positive modulus, got "+t);let r=j(e,t),n=t,o=at,s=X,i=X,a=at;for(;r!==at;){let h=n/r,f=n%r,u=o-i*h,m=s-a*h;n=r,r=f,o=i,s=a,i=u,a=m}if(n!==X)throw new Error("invert: does not exist");return j(o,t)}function Ts(e,t){let r=(e.ORDER+X)/_s,n=e.pow(t,r);if(!e.eql(e.sqr(n),t))throw new Error("Cannot find square root");return n}function gc(e,t){let r=(e.ORDER-Ks)/Ls,n=e.mul(t,oe),o=e.pow(n,r),s=e.mul(t,o),i=e.mul(e.mul(s,oe),o),a=e.mul(s,e.sub(i,e.ONE));if(!e.eql(e.sqr(a),t))throw new Error("Cannot find square root");return a}function Ec(e){if(e<BigInt(3))throw new Error("sqrt is not defined for small field");let t=e-X,r=0;for(;t%oe===at;)t/=oe,r++;let n=oe,o=gt(e);for(;Is(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Ts;let s=o.pow(n,t),i=(t+X)/oe;return function(c,h){if(c.is0(h))return h;if(Is(c,h)!==1)throw new Error("Cannot find square root");let f=r,u=c.mul(c.ONE,s),m=c.pow(h,t),b=c.pow(h,i);for(;!c.eql(m,c.ONE);){if(c.is0(m))return c.ZERO;let g=1,E=c.sqr(m);for(;!c.eql(E,c.ONE);)if(g++,E=c.sqr(E),g===f)throw new Error("Cannot find square root");let y=X<<BigInt(f-g-1),S=c.pow(u,y);f=g,u=c.sqr(S),m=c.mul(m,u),b=c.mul(b,S)}return b}}function Ac(e){return e%_s===wc?Ts:e%Ls===Ks?gc:Ec(e)}var Us=(e,t)=>(j(e,t)&X)===X,Sc=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Mn(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=Sc.reduce((n,o)=>(n[o]="function",n),t);return Vt(e,r),e}function Bc(e,t,r){if(r<at)throw new Error("invalid exponent, negatives unsupported");if(r===at)return e.ONE;if(r===X)return t;let n=e.ONE,o=t;for(;r>at;)r&X&&(n=e.mul(n,o)),o=e.sqr(o),r>>=X;return n}function tr(e,t,r=!1){let n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce((i,a,c)=>e.is0(a)?i:(n[c]=i,e.mul(i,a)),e.ONE),s=e.inv(o);return t.reduceRight((i,a,c)=>e.is0(a)?i:(n[c]=e.mul(i,n[c]),e.mul(i,a)),s),n}function Is(e,t){let r=(e.ORDER-X)/oe,n=e.pow(t,r),o=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),i=e.eql(n,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function Cs(e,t){t!==void 0&&Ct(t);let r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function gt(e,t,r=!1,n={}){if(e<=at)throw new Error("invalid field: expected ORDER > 0, got "+e);let o,s;if(typeof t=="object"&&t!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");let f=t;f.BITS&&(o=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE)}else typeof t=="number"&&(o=t),n.sqrt&&(s=n.sqrt);let{nBitLength:i,nByteLength:a}=Cs(e,o);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c,h=Object.freeze({ORDER:e,isLE:r,BITS:i,BYTES:a,MASK:ne(i),ZERO:at,ONE:X,create:f=>j(f,e),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return at<=f&&f<e},is0:f=>f===at,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&X)===X,neg:f=>j(-f,e),eql:(f,u)=>f===u,sqr:f=>j(f*f,e),add:(f,u)=>j(f+u,e),sub:(f,u)=>j(f-u,e),mul:(f,u)=>j(f*u,e),pow:(f,u)=>Bc(h,f,u),div:(f,u)=>j(f*vs(u,e),e),sqrN:f=>f*f,addN:(f,u)=>f+u,subN:(f,u)=>f-u,mulN:(f,u)=>f*u,inv:f=>vs(f,e),sqrt:s||(f=>(c||(c=Ac(e)),c(h,f))),toBytes:f=>r?Ie(f,a):Tr(f,a),fromBytes:f=>{if(f.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);return r?re(f):ve(f)},invertBatch:f=>tr(h,f),cmov:(f,u,m)=>m?u:f});return Object.freeze(h)}function Ds(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function qn(e){let t=Ds(e);return t+Math.ceil(t/2)}function Ps(e,t,r=!1){let n=e.length,o=Ds(t),s=qn(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=r?re(e):ve(e),a=j(i,t-X)+X;return r?Ie(a,o):Tr(a,o)}var Le=BigInt(0),se=BigInt(1);function Ke(e,t){let r=t.negate();return e?r:t}function Ur(e,t,r){let n=t==="pz"?i=>i.pz:i=>i.ez,o=tr(e.Fp,r.map(n));return r.map((i,a)=>i.toAffine(o[a])).map(e.fromAffine)}function Hs(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Vn(e,t){Hs(e,t);let r=Math.ceil(t/e)+1,n=2**(e-1),o=2**e,s=ne(e),i=BigInt(e);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function Rs(e,t,r){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r,a=Number(e&o),c=e>>i;a>n&&(a-=s,c+=se);let h=t*n,f=h+Math.abs(a)-1,u=a===0,m=a<0,b=t%2!==0;return{nextN:c,offset:f,isZero:u,isNeg:m,isNegF:b,offsetF:h}}function vc(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((r,n)=>{if(!(r instanceof t))throw new Error("invalid point at index "+n)})}function Ic(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((r,n)=>{if(!t.isValid(r))throw new Error("invalid scalar at index "+n)})}var zn=new WeakMap,Os=new WeakMap;function Fn(e){return Os.get(e)||1}function Ns(e){if(e!==Le)throw new Error("invalid wNAF")}function Cr(e,t){return{constTimeNegate:Ke,hasPrecomputes(r){return Fn(r)!==1},unsafeLadder(r,n,o=e.ZERO){let s=r;for(;n>Le;)n&se&&(o=o.add(s)),s=s.double(),n>>=se;return o},precomputeWindow(r,n){let{windows:o,windowSize:s}=Vn(n,t),i=[],a=r,c=a;for(let h=0;h<o;h++){c=a,i.push(c);for(let f=1;f<s;f++)c=c.add(a),i.push(c);a=c.double()}return i},wNAF(r,n,o){let s=e.ZERO,i=e.BASE,a=Vn(r,t);for(let c=0;c<a.windows;c++){let{nextN:h,offset:f,isZero:u,isNeg:m,isNegF:b,offsetF:g}=Rs(o,c,a);o=h,u?i=i.add(Ke(b,n[g])):s=s.add(Ke(m,n[f]))}return Ns(o),{p:s,f:i}},wNAFUnsafe(r,n,o,s=e.ZERO){let i=Vn(r,t);for(let a=0;a<i.windows&&o!==Le;a++){let{nextN:c,offset:h,isZero:f,isNeg:u}=Rs(o,a,i);if(o=c,!f){let m=n[h];s=s.add(u?m.negate():m)}}return Ns(o),s},getPrecomputes(r,n,o){let s=zn.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&(typeof o=="function"&&(s=o(s)),zn.set(n,s))),s},wNAFCached(r,n,o){let s=Fn(r);return this.wNAF(s,this.getPrecomputes(s,r,o),n)},wNAFCachedUnsafe(r,n,o,s){let i=Fn(r);return i===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(i,this.getPrecomputes(i,r,o),n,s)},setWindowSize(r,n){Hs(n,t),Os.set(r,n),zn.delete(r)}}}function Ms(e,t,r,n){let o=t,s=e.ZERO,i=e.ZERO;for(;r>Le||n>Le;)r&se&&(s=s.add(o)),n&se&&(i=i.add(o)),o=o.double(),r>>=se,n>>=se;return{p1:s,p2:i}}function Dr(e,t,r,n){vc(r,e),Ic(n,t);let o=r.length,s=n.length;if(o!==s)throw new Error("arrays of points and scalars must have equal length");let i=e.ZERO,a=Ss(BigInt(o)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let h=ne(c),f=new Array(Number(h)+1).fill(i),u=Math.floor((t.BITS-1)/c)*c,m=i;for(let b=u;b>=0;b-=c){f.fill(i);for(let E=0;E<s;E++){let y=n[E],S=Number(y>>BigInt(b)&h);f[S]=f[S].add(r[E])}let g=i;for(let E=f.length-1,y=i;E>0;E--)y=y.add(f[E]),g=g.add(y);if(m=m.add(g),b!==0)for(let E=0;E<c;E++)m=m.double()}return m}function ks(e,t){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Mn(t),t}else return gt(e)}function Pr(e,t,r={}){if(!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let a of["p","n","h"]){let c=t[a];if(!(typeof c=="bigint"&&c>Le))throw new Error(`CURVE.${a} must be positive bigint`)}let n=ks(t.p,r.Fp),o=ks(t.n,r.Fn),i=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let a of i)if(!n.isValid(t[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return{Fp:n,Fn:o}}var It=BigInt(0),ct=BigInt(1),jn=BigInt(2),_c=BigInt(8),Kc={zip215:!0};function Lc(e,t,r,n){let o=e.sqr(r),s=e.sqr(n),i=e.add(e.mul(t.a,o),s),a=e.add(e.ONE,e.mul(t.d,e.mul(o,s)));return e.eql(i,a)}function Tc(e,t={}){let{Fp:r,Fn:n}=Pr("edwards",e,t),{h:o,n:s}=e;Vt(t,{},{uvRatio:"function"});let i=jn<<BigInt(n.BYTES*8)-ct,a=E=>r.create(E),c=t.uvRatio||((E,y)=>{try{return{isValid:!0,value:r.sqrt(r.div(E,y))}}catch{return{isValid:!1,value:It}}});if(!Lc(r,e,e.Gx,e.Gy))throw new Error("bad curve params: generator point");function h(E,y,S=!1){let I=S?ct:It;return qt("coordinate "+E,y,I,i),y}function f(E){if(!(E instanceof b))throw new Error("ExtendedPoint expected")}let u=_e((E,y)=>{let{ex:S,ey:I,ez:B}=E,C=E.is0();y==null&&(y=C?_c:r.inv(B));let p=a(S*y),U=a(I*y),T=a(B*y);if(C)return{x:It,y:ct};if(T!==ct)throw new Error("invZ was invalid");return{x:p,y:U}}),m=_e(E=>{let{a:y,d:S}=e;if(E.is0())throw new Error("bad point: ZERO");let{ex:I,ey:B,ez:C,et:p}=E,U=a(I*I),T=a(B*B),_=a(C*C),l=a(_*_),w=a(U*y),d=a(_*a(w+T)),x=a(l+a(S*a(U*T)));if(d!==x)throw new Error("bad point: equation left != right (1)");let A=a(I*B),K=a(C*p);if(A!==K)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(y,S,I,B){this.ex=h("x",y),this.ey=h("y",S),this.ez=h("z",I,!0),this.et=h("t",B),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(y){if(y instanceof b)throw new Error("extended point not allowed");let{x:S,y:I}=y||{};return h("x",S),h("y",I),new b(S,I,ct,a(S*I))}static normalizeZ(y){return Ur(b,"ez",y)}static msm(y,S){return Dr(b,n,y,S)}_setWindowSize(y){this.precompute(y)}precompute(y=8,S=!0){return g.setWindowSize(this,y),S||this.multiply(jn),this}assertValidity(){m(this)}equals(y){f(y);let{ex:S,ey:I,ez:B}=this,{ex:C,ey:p,ez:U}=y,T=a(S*U),_=a(C*B),l=a(I*U),w=a(p*B);return T===_&&l===w}is0(){return this.equals(b.ZERO)}negate(){return new b(a(-this.ex),this.ey,this.ez,a(-this.et))}double(){let{a:y}=e,{ex:S,ey:I,ez:B}=this,C=a(S*S),p=a(I*I),U=a(jn*a(B*B)),T=a(y*C),_=S+I,l=a(a(_*_)-C-p),w=T+p,d=w-U,x=T-p,A=a(l*d),K=a(w*x),v=a(l*x),L=a(d*w);return new b(A,K,L,v)}add(y){f(y);let{a:S,d:I}=e,{ex:B,ey:C,ez:p,et:U}=this,{ex:T,ey:_,ez:l,et:w}=y,d=a(B*T),x=a(C*_),A=a(U*I*w),K=a(p*l),v=a((B+C)*(T+_)-d-x),L=K-A,P=K+A,D=a(x-S*d),Z=a(v*L),H=a(P*D),R=a(v*D),$=a(L*P);return new b(Z,H,$,R)}subtract(y){return this.add(y.negate())}multiply(y){let S=y;qt("scalar",S,ct,s);let{p:I,f:B}=g.wNAFCached(this,S,b.normalizeZ);return b.normalizeZ([I,B])[0]}multiplyUnsafe(y,S=b.ZERO){let I=y;return qt("scalar",I,It,s),I===It?b.ZERO:this.is0()||I===ct?this:g.wNAFCachedUnsafe(this,I,b.normalizeZ,S)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}isTorsionFree(){return g.wNAFCachedUnsafe(this,s).is0()}toAffine(y){return u(this,y)}clearCofactor(){return o===ct?this:this.multiplyUnsafe(o)}static fromBytes(y,S=!1){return J(y),this.fromHex(y,S)}static fromHex(y,S=!1){let{d:I,a:B}=e,C=r.BYTES;y=V("pointHex",y,C),Pt("zip215",S);let p=y.slice(),U=y[C-1];p[C-1]=U&-129;let T=re(p),_=S?i:r.ORDER;qt("pointHex.y",T,It,_);let l=a(T*T),w=a(l-ct),d=a(I*l-B),{isValid:x,value:A}=c(w,d);if(!x)throw new Error("Point.fromHex: invalid y coordinate");let K=(A&ct)===ct,v=(U&128)!==0;if(!S&&A===It&&v)throw new Error("Point.fromHex: x=0 and x_0=1");return v!==K&&(A=a(-A)),b.fromAffine({x:A,y:T})}static fromPrivateScalar(y){return b.BASE.multiply(y)}toBytes(){let{x:y,y:S}=this.toAffine(),I=Ie(S,r.BYTES);return I[I.length-1]|=y&ct?128:0,I}toRawBytes(){return this.toBytes()}toHex(){return Bt(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}b.BASE=new b(e.Gx,e.Gy,ct,a(e.Gx*e.Gy)),b.ZERO=new b(It,ct,ct,It),b.Fp=r,b.Fn=n;let g=Cr(b,n.BYTES*8);return b}function Uc(e,t){Vt(t,{hash:"function"},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:r,hash:n}=t,{BASE:o,Fp:s,Fn:i}=e,a=i.ORDER,c=t.randomBytes||Jt,h=t.adjustScalarBytes||(p=>p),f=t.domain||((p,U,T)=>{if(Pt("phflag",T),U.length||T)throw new Error("Contexts/pre-hash are not supported");return p});function u(p){return i.create(p)}function m(p){return u(re(p))}function b(p){let U=s.BYTES;p=V("private key",p,U);let T=V("hashed private key",n(p),2*U),_=h(T.slice(0,U)),l=T.slice(U,2*U),w=m(_);return{head:_,prefix:l,scalar:w}}function g(p){let{head:U,prefix:T,scalar:_}=b(p),l=o.multiply(_),w=l.toBytes();return{head:U,prefix:T,scalar:_,point:l,pointBytes:w}}function E(p){return g(p).pointBytes}function y(p=Uint8Array.of(),...U){let T=dt(...U);return m(n(f(T,V("context",p),!!r)))}function S(p,U,T={}){p=V("message",p),r&&(p=r(p));let{prefix:_,scalar:l,pointBytes:w}=g(U),d=y(T.context,_,p),x=o.multiply(d).toBytes(),A=y(T.context,x,w,p),K=u(d+A*l);qt("signature.s",K,It,a);let v=s.BYTES,L=dt(x,Ie(K,v));return V("result",L,v*2)}let I=Kc;function B(p,U,T,_=I){let{context:l,zip215:w}=_,d=s.BYTES;p=V("signature",p,2*d),U=V("message",U),T=V("publicKey",T,d),w!==void 0&&Pt("zip215",w),r&&(U=r(U));let x=re(p.slice(d,2*d)),A,K,v;try{A=e.fromHex(T,w),K=e.fromHex(p.slice(0,d),w),v=o.multiplyUnsafe(x)}catch{return!1}if(!w&&A.isSmallOrder())return!1;let L=y(l,K.toBytes(),A.toBytes(),U);return K.add(A.multiplyUnsafe(L)).subtract(v).clearCofactor().is0()}return o.precompute(8),{getPublicKey:E,sign:S,verify:B,utils:{getExtendedPublicKey:g,randomPrivateKey:()=>c(s.BYTES),precompute(p=8,U=e.BASE){return U.precompute(p,!1)}},Point:e}}function Cc(e){let t={a:e.a,d:e.d,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,n=gt(t.n,e.nBitLength,!0),o={Fp:r,Fn:n,uvRatio:e.uvRatio},s={hash:e.hash,randomBytes:e.randomBytes,adjustScalarBytes:e.adjustScalarBytes,domain:e.domain,prehash:e.prehash,mapToCurve:e.mapToCurve};return{CURVE:t,curveOpts:o,eddsaOpts:s}}function Dc(e,t){return Object.assign({},t,{ExtendedPoint:t.Point,CURVE:e})}function qs(e){let{CURVE:t,curveOpts:r,eddsaOpts:n}=Cc(e),o=Tc(t,r),s=Uc(o,n);return Dc(e,s)}var $h=BigInt(0),Pc=BigInt(1),Vs=BigInt(2),Yh=BigInt(3),Rc=BigInt(5),Nc=BigInt(8),Rr={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Nc,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function kc(e){let t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),s=Rr.p,a=e*e%s*e%s,c=z(a,Vs,s)*a%s,h=z(c,Pc,s)*e%s,f=z(h,Rc,s)*h%s,u=z(f,t,s)*f%s,m=z(u,r,s)*u%s,b=z(m,n,s)*m%s,g=z(b,o,s)*b%s,E=z(g,o,s)*b%s,y=z(E,t,s)*f%s;return{pow_p_5_8:z(y,Vs,s)*e%s,b2:a}}function Hc(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var zs=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Oc(e,t){let r=Rr.p,n=j(t*t*t,r),o=j(n*n*t,r),s=kc(e*o).pow_p_5_8,i=j(e*n*s,r),a=j(t*i*i,r),c=i,h=j(i*zs,r),f=a===e,u=a===j(-e,r),m=a===j(-e*zs,r);return f&&(i=c),(u||m)&&(i=h),Us(i,r)&&(i=j(-i,r)),{isValid:f||u,value:i}}var Mc=gt(Rr.p,void 0,!0),qc={...Rr,Fp:Mc,hash:Lr,adjustScalarBytes:Hc,uvRatio:Oc},Te=qs(qc);var zt=32,pt=64,Nr=32;var Ue,Fs=(async()=>{try{return await F.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();function js(){let e=Te.utils.randomPrivateKey(),t=Te.getPublicKey(e);return{privateKey:Ys(e,t),publicKey:t}}function Gs(e){if(e.length!==Nr)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');let t=e,r=Te.getPublicKey(t);return{privateKey:Ys(t,r),publicKey:r}}async function Vc(e,t){let r;e.length===pt?r=e.subarray(0,32):r=e;let n={crv:"Ed25519",kty:"OKP",x:k(e.subarray(32),"base64url"),d:k(r,"base64url"),ext:!0,key_ops:["sign"]},o=await F.get().subtle.importKey("jwk",n,{name:"Ed25519"},!0,["sign"]),s=await F.get().subtle.sign({name:"Ed25519"},o,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(s,0,s.byteLength)}function zc(e,t){let r=e.subarray(0,Nr);return Te.sign(t instanceof Uint8Array?t:t.subarray(),r)}async function Zs(e,t){return Ue==null&&(Ue=await Fs),Ue?Vc(e,t):zc(e,t)}async function Fc(e,t,r){if(e.buffer instanceof ArrayBuffer){let n=await F.get().subtle.importKey("raw",e.buffer,{name:"Ed25519"},!1,["verify"]);return await F.get().subtle.verify({name:"Ed25519"},n,t,r instanceof Uint8Array?r:r.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function jc(e,t,r){return Te.verify(t,r instanceof Uint8Array?r:r.subarray(),e)}async function $s(e,t,r){return Ue==null&&(Ue=await Fs),Ue?Fc(e,t,r):jc(e,t,r)}function Ys(e,t){let r=new Uint8Array(pt);for(let n=0;n<Nr;n++)r[n]=e[n],r[Nr+n]=t[n];return r}function Gn(e,t){let r=q(e,"base64urlpad");if(t!=null){if(r.length>t)throw new Error("byte array longer than desired length");r=St([new Uint8Array(t-r.length),r])}return r}function Ce(e){return e==null?!1:typeof e.then=="function"&&typeof e.catch=="function"&&typeof e.finally=="function"}var er=class{type="Ed25519";raw;constructor(t){this.raw=De(t,zt)}toMultihash(){return $t.digest(Wt(this))}toCID(){return yt.createV1(114,this.toMultihash())}toString(){return W.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:rt(this.raw,t.raw)}verify(t,r,n){n?.signal?.throwIfAborted();let o=$s(this.raw,r,t);return Ce(o)?o.then(s=>(n?.signal?.throwIfAborted(),s)):o}},ie=class{type="Ed25519";raw;publicKey;constructor(t,r){this.raw=De(t,pt),this.publicKey=new er(r)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:rt(this.raw,t.raw)}sign(t,r){r?.signal?.throwIfAborted();let n=Zs(this.raw,t);return Ce(n)?n.then(o=>(r?.signal?.throwIfAborted(),o)):(r?.signal?.throwIfAborted(),n)}};function Zn(e){if(e.length>pt){e=De(e,pt+zt);let n=e.subarray(0,pt),o=e.subarray(pt,e.length);return new ie(n,o)}e=De(e,pt);let t=e.subarray(0,pt),r=e.subarray(zt);return new ie(t,r)}function kr(e){return e=De(e,zt),new er(e)}async function Xs(){let{privateKey:e,publicKey:t}=js();return new ie(e,t)}async function Js(e){let{privateKey:t,publicKey:r}=Gs(e);return new ie(t,r)}function De(e,t){if(e=Uint8Array.from(e??[]),e.length!==t)throw new N(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}var Gc=Math.pow(2,7),Zc=Math.pow(2,14),$c=Math.pow(2,21),Qs=Math.pow(2,28),ti=Math.pow(2,35),ei=Math.pow(2,42),ri=Math.pow(2,49),ft=128,Ft=127;function rr(e){if(e<Gc)return 1;if(e<Zc)return 2;if(e<$c)return 3;if(e<Qs)return 4;if(e<ti)return 5;if(e<ei)return 6;if(e<ri)return 7;if(Number.MAX_SAFE_INTEGER!=null&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function ni(e,t,r=0){switch(rr(e)){case 8:t[r++]=e&255|ft,e/=128;case 7:t[r++]=e&255|ft,e/=128;case 6:t[r++]=e&255|ft,e/=128;case 5:t[r++]=e&255|ft,e/=128;case 4:t[r++]=e&255|ft,e>>>=7;case 3:t[r++]=e&255|ft,e>>>=7;case 2:t[r++]=e&255|ft,e>>>=7;case 1:{t[r++]=e&255,e>>>=7;break}default:throw new Error("unreachable")}return t}function oi(e,t){let r=e[t],n=0;if(n+=r&Ft,r<ft||(r=e[t+1],n+=(r&Ft)<<7,r<ft)||(r=e[t+2],n+=(r&Ft)<<14,r<ft)||(r=e[t+3],n+=(r&Ft)<<21,r<ft)||(r=e[t+4],n+=(r&Ft)*Qs,r<ft)||(r=e[t+5],n+=(r&Ft)*ti,r<ft)||(r=e[t+6],n+=(r&Ft)*ei,r<ft)||(r=e[t+7],n+=(r&Ft)*ri,r<ft))return n;throw new RangeError("Could not decode varint")}var $n=new Float32Array([-0]),jt=new Uint8Array($n.buffer);function si(e,t,r){$n[0]=e,t[r]=jt[0],t[r+1]=jt[1],t[r+2]=jt[2],t[r+3]=jt[3]}function ii(e,t){return jt[0]=e[t],jt[1]=e[t+1],jt[2]=e[t+2],jt[3]=e[t+3],$n[0]}var Yn=new Float64Array([-0]),nt=new Uint8Array(Yn.buffer);function ai(e,t,r){Yn[0]=e,t[r]=nt[0],t[r+1]=nt[1],t[r+2]=nt[2],t[r+3]=nt[3],t[r+4]=nt[4],t[r+5]=nt[5],t[r+6]=nt[6],t[r+7]=nt[7]}function ci(e,t){return nt[0]=e[t],nt[1]=e[t+1],nt[2]=e[t+2],nt[3]=e[t+3],nt[4]=e[t+4],nt[5]=e[t+5],nt[6]=e[t+6],nt[7]=e[t+7],Yn[0]}var Yc=BigInt(Number.MAX_SAFE_INTEGER),Wc=BigInt(Number.MIN_SAFE_INTEGER),mt=class e{lo;hi;constructor(t,r){this.lo=t|0,this.hi=r|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?t<16384?t<128?1:2:t<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return ae;if(t<Yc&&t>Wc)return this.fromNumber(Number(t));let r=t<0n;r&&(t=-t);let n=t>>32n,o=t-(n<<32n);return r&&(n=~n|0n,o=~o|0n,++o>fi&&(o=0n,++n>fi&&(n=0n))),new e(Number(o),Number(n))}static fromNumber(t){if(t===0)return ae;let r=t<0;r&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return r&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new e(n,o)}static from(t){return typeof t=="number"?e.fromNumber(t):typeof t=="bigint"?e.fromBigInt(t):typeof t=="string"?e.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new e(t.low>>>0,t.high>>>0):ae}},ae=new mt(0,0);ae.toBigInt=function(){return 0n};ae.zzEncode=ae.zzDecode=function(){return this};ae.length=function(){return 1};var fi=4294967296n;function ui(e){let t=0,r=0;for(let n=0;n<e.length;++n)r=e.charCodeAt(n),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function hi(e,t,r){if(r-t<1)return"";let o,s=[],i=0,a;for(;t<r;)a=e[t++],a<128?s[i++]=a:a>191&&a<224?s[i++]=(a&31)<<6|e[t++]&63:a>239&&a<365?(a=((a&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,s[i++]=55296+(a>>10),s[i++]=56320+(a&1023)):s[i++]=(a&15)<<12|(e[t++]&63)<<6|e[t++]&63,i>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,s)),i=0);return o!=null?(i>0&&o.push(String.fromCharCode.apply(String,s.slice(0,i))),o.join("")):String.fromCharCode.apply(String,s.slice(0,i))}function Wn(e,t,r){let n=r,o,s;for(let i=0;i<e.length;++i)o=e.charCodeAt(i),o<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=o&63|128):(o&64512)===55296&&((s=e.charCodeAt(i+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++i,t[r++]=o>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=o&63|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=o&63|128);return r-n}function Et(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function Hr(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}var Xn=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Et(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Et(this,4);return Hr(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Et(this,4);return Hr(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Et(this,4);let t=ii(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw Et(this,4);let t=ci(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),r=this.pos,n=this.pos+t;if(n>this.len)throw Et(this,t);return this.pos+=t,r===n?new Uint8Array(0):this.buf.subarray(r,n)}string(){let t=this.bytes();return hi(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw Et(this,t);this.pos+=t}else do if(this.pos>=this.len)throw Et(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new mt(0,0),r=0;if(this.len-this.pos>4){for(;r<4;++r)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;r=0}else{for(;r<3;++r){if(this.pos>=this.len)throw Et(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<r*7)>>>0,t}if(this.len-this.pos>4){for(;r<5;++r)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;r<5;++r){if(this.pos>=this.len)throw Et(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Et(this,8);let t=Hr(this.buf,this.pos+=4),r=Hr(this.buf,this.pos+=4);return new mt(t,r)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=oi(this.buf,this.pos);return this.pos+=rr(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function Jn(e){return new Xn(e instanceof Uint8Array?e:e.subarray())}function Or(e,t,r){let n=Jn(e);return t.decode(n,void 0,r)}function Qn(e){let t=e??8192,r=t>>>1,n,o=t;return function(i){if(i<1||i>r)return ht(i);o+i>t&&(n=ht(t),o=0);let a=n.subarray(o,o+=i);return(o&7)!==0&&(o=(o|7)+1),a}}var ce=class{fn;len;next;val;constructor(t,r,n){this.fn=t,this.len=r,this.next=void 0,this.val=n}};function to(){}var ro=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},Xc=Qn();function Jc(e){return globalThis.Buffer!=null?ht(e):Xc(e)}var or=class{len;head;tail;states;constructor(){this.len=0,this.head=new ce(to,0,0),this.tail=this.head,this.states=null}_push(t,r,n){return this.tail=this.tail.next=new ce(t,r,n),this.len+=r,this}uint32(t){return this.len+=(this.tail=this.tail.next=new no((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(Mr,10,mt.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let r=mt.fromBigInt(t);return this._push(Mr,r.length(),r)}uint64Number(t){return this._push(ni,rr(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let r=mt.fromBigInt(t).zzEncode();return this._push(Mr,r.length(),r)}sint64Number(t){let r=mt.fromNumber(t).zzEncode();return this._push(Mr,r.length(),r)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(eo,1,t?1:0)}fixed32(t){return this._push(nr,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let r=mt.fromBigInt(t);return this._push(nr,4,r.lo)._push(nr,4,r.hi)}fixed64Number(t){let r=mt.fromNumber(t);return this._push(nr,4,r.lo)._push(nr,4,r.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(si,4,t)}double(t){return this._push(ai,8,t)}bytes(t){let r=t.length>>>0;return r===0?this._push(eo,1,0):this.uint32(r)._push(tf,r,t)}string(t){let r=ui(t);return r!==0?this.uint32(r)._push(Wn,r,t):this._push(eo,1,0)}fork(){return this.states=new ro(this),this.head=this.tail=new ce(to,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ce(to,0,0),this.len=0),this}ldelim(){let t=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=r,this.len+=n),this}finish(){let t=this.head.next,r=Jc(this.len),n=0;for(;t!=null;)t.fn(t.val,r,n),n+=t.len,t=t.next;return r}};function eo(e,t,r){t[r]=e&255}function Qc(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}var no=class extends ce{next;constructor(t,r){super(Qc,t,r),this.next=void 0}};function Mr(e,t,r){for(;e.hi!==0;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}function nr(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function tf(e,t,r){t.set(e,r)}globalThis.Buffer!=null&&(or.prototype.bytes=function(e){let t=e.length>>>0;return this.uint32(t),t>0&&this._push(ef,t,e),this},or.prototype.string=function(e){let t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(rf,t,e),this});function ef(e,t,r){t.set(e,r)}function rf(e,t,r){e.length<40?Wn(e,t,r):t.utf8Write!=null?t.utf8Write(e,r):t.set(q(e),r)}function oo(){return new or}function qr(e,t){let r=oo();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var Pe;(function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"})(Pe||(Pe={}));function Vr(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function so(e){function t(o){if(e[o.toString()]==null)throw new Error("Invalid enum value");return e[o]}let r=function(s,i){let a=t(s);i.int32(a)},n=function(s){let i=s.int32();return t(i)};return Vr("enum",Pe.VARINT,r,n)}function zr(e,t){return Vr("message",Pe.LENGTH_DELIMITED,e,t)}var O;(function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"})(O||(O={}));var io;(function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"})(io||(io={}));(function(e){e.codec=()=>so(io)})(O||(O={}));var _t;(function(e){let t;e.codec=()=>(t==null&&(t=zr((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),O.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.Type=O.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>qr(r,e.codec()),e.decode=(r,n)=>Or(r,e.codec(),n)})(_t||(_t={}));var sr;(function(e){let t;e.codec=()=>(t==null&&(t=zr((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),O.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.Type=O.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>qr(r,e.codec()),e.decode=(r,n)=>Or(r,e.codec(),n)})(sr||(sr={}));function ao(e){if(isNaN(e)||e<=0)throw new N("random bytes length must be a Number bigger than 0");return Jt(e)}var ar={};et(ar,{MAX_RSA_KEY_SIZE:()=>co,generateRSAKeyPair:()=>yo,jwkToJWKKeyPair:()=>yi,jwkToPkcs1:()=>af,jwkToPkix:()=>lo,jwkToRSAPrivateKey:()=>Gr,pkcs1MessageToJwk:()=>uo,pkcs1MessageToRSAPrivateKey:()=>Fr,pkcs1ToJwk:()=>sf,pkcs1ToRSAPrivateKey:()=>po,pkixMessageToJwk:()=>ho,pkixMessageToRSAPublicKey:()=>jr,pkixToJwk:()=>cf,pkixToRSAPublicKey:()=>mo});var Re=Kr;var Ne=class{type="RSA";jwk;_raw;_multihash;constructor(t,r){this.jwk=t,this._multihash=r}get raw(){return this._raw==null&&(this._raw=ar.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return yt.createV1(114,this._multihash)}toString(){return W.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:rt(this.raw,t.raw)}verify(t,r,n){return mi(this.jwk,r,t,n)}},ir=class{type="RSA";jwk;_raw;publicKey;constructor(t,r){this.jwk=t,this.publicKey=r}get raw(){return this._raw==null&&(this._raw=ar.jwkToPkcs1(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:rt(this.raw,t.raw)}sign(t,r){return pi(this.jwk,t,r)}};var co=8192,fo=18,nf=1062,of=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function sf(e){let t=lt(e);return uo(t)}function uo(e){return{n:k(e[1],"base64url"),e:k(e[2],"base64url"),d:k(e[3],"base64url"),p:k(e[4],"base64url"),q:k(e[5],"base64url"),dp:k(e[6],"base64url"),dq:k(e[7],"base64url"),qi:k(e[8],"base64url"),kty:"RSA"}}function af(e){if(e.n==null||e.e==null||e.d==null||e.p==null||e.q==null||e.dp==null||e.dq==null||e.qi==null)throw new N("JWK was missing components");return xt([it(Uint8Array.from([0])),it(q(e.n,"base64url")),it(q(e.e,"base64url")),it(q(e.d,"base64url")),it(q(e.p,"base64url")),it(q(e.q,"base64url")),it(q(e.dp,"base64url")),it(q(e.dq,"base64url")),it(q(e.qi,"base64url"))]).subarray()}function cf(e){let t=lt(e,{offset:0});return ho(t)}function ho(e){let t=lt(e[1],{offset:0});return{kty:"RSA",n:k(t[0],"base64url"),e:k(t[1],"base64url")}}function lo(e){if(e.n==null||e.e==null)throw new N("JWK was missing components");return xt([of,$e(xt([it(q(e.n,"base64url")),it(q(e.e,"base64url"))]))]).subarray()}function po(e){let t=lt(e);return Fr(t)}function Fr(e){let t=uo(e);return Gr(t)}function mo(e,t){if(e.byteLength>=nf)throw new he("Key size is too large");let r=lt(e,{offset:0});return jr(r,e,t)}function jr(e,t,r){let n=ho(e);if(r==null){let o=Re(_t.encode({Type:O.RSA,Data:t}));r=bt(fo,o)}return new Ne(n,r)}function Gr(e){if(xi(e)>co)throw new N("Key size is too large");let t=yi(e),r=Re(_t.encode({Type:O.RSA,Data:lo(t.publicKey)})),n=bt(fo,r);return new ir(t.privateKey,new Ne(t.publicKey,n))}async function yo(e){if(e>co)throw new N("Key size is too large");let t=await bi(e),r=Re(_t.encode({Type:O.RSA,Data:lo(t.publicKey)})),n=bt(fo,r);return new ir(t.privateKey,new Ne(t.publicKey,n))}function yi(e){if(e==null)throw new N("Missing key parameter");return{privateKey:e,publicKey:{kty:e.kty,n:e.n,e:e.e}}}var wi="1.2.840.113549.1.1.1";async function bi(e,t){let r=await F.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);t?.signal?.throwIfAborted();let n=await ff(r,t);return{privateKey:n[0],publicKey:n[1]}}async function pi(e,t,r){let n=await F.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);r?.signal?.throwIfAborted();let o=await F.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function mi(e,t,r,n){let o=await F.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();let s=await F.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},o,t,r instanceof Uint8Array?r:r.subarray());return n?.signal?.throwIfAborted(),s}async function ff(e,t){if(e.privateKey==null||e.publicKey==null)throw new N("Private and public key are required");let r=await Promise.all([F.get().subtle.exportKey("jwk",e.privateKey),F.get().subtle.exportKey("jwk",e.publicKey)]);return t?.signal?.throwIfAborted(),r}function xi(e){if(e.kty!=="RSA")throw new N("invalid key type");if(e.n==null)throw new N("invalid key modulus");return q(e.n,"base64url").length*8}var Zr=class extends ge{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,Er(t);let n=Ye(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(n.length>o?t.create().update(n).digest():n);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),ut(s)}update(t){return Ae(this),this.iHash.update(t),this}digestInto(t){Ae(this),J(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},cr=(e,t,r)=>new Zr(e,t).update(r).digest();cr.create=(e,t)=>new Zr(e,t);function gi(e){e.lowS!==void 0&&Pt("lowS",e.lowS),e.prehash!==void 0&&Pt("prehash",e.prehash)}var bo=class extends Error{constructor(t=""){super(t)}},Rt={Err:bo,_tlv:{encode:(e,t)=>{let{Err:r}=Rt;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length&1)throw new r("tlv.encode: unpadded data");let n=t.length/2,o=Qe(n);if(o.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?Qe(o.length/2|128):"";return Qe(e)+s+o+t},decode(e,t){let{Err:r}=Rt,n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");let o=t[n++],s=!!(o&128),i=0;if(!s)i=o;else{let c=o&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");let h=t.subarray(n,n+c);if(h.length!==c)throw new r("tlv.decode: length bytes not complete");if(h[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let f of h)i=i<<8|f;if(n+=c,i<128)throw new r("tlv.decode(long): not minimal encoding")}let a=t.subarray(n,n+i);if(a.length!==i)throw new r("tlv.decode: wrong value length");return{v:a,l:t.subarray(n+i)}}},_int:{encode(e){let{Err:t}=Rt;if(e<fr)throw new t("integer: negative integers are not allowed");let r=Qe(e);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=Rt;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return ve(e)}},toSig(e){let{Err:t,_int:r,_tlv:n}=Rt,o=V("signature",e),{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,s),{v:h,l:f}=n.decode(2,c);if(f.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(h)}},hexFromSig(e){let{_tlv:t,_int:r}=Rt,n=t.encode(2,r.encode(e.r)),o=t.encode(2,r.encode(e.s)),s=n+o;return t.encode(48,s)}},fr=BigInt(0),ur=BigInt(1),uf=BigInt(2),$r=BigInt(3),hf=BigInt(4);function lf(e,t,r){function n(o){let s=e.sqr(o),i=e.mul(s,o);return e.add(e.add(i,e.mul(o,t)),r)}return n}function Ei(e,t,r){let{BYTES:n}=e;function o(s){let i;if(typeof s=="bigint")i=s;else{let a=V("private key",s);if(t){if(!t.includes(a.length*2))throw new Error("invalid private key");let c=new Uint8Array(n);c.set(a,c.length-a.length),a=c}try{i=e.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof s}`)}}if(r&&(i=e.create(i)),!e.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}return o}function df(e,t={}){let{Fp:r,Fn:n}=Pr("weierstrass",e,t),{h:o,n:s}=e;Vt(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:i}=t;if(i&&(!r.is0(e.a)||typeof i.beta!="bigint"||typeof i.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function c(_,l,w){let{x:d,y:x}=l.toAffine(),A=r.toBytes(d);if(Pt("isCompressed",w),w){a();let K=!r.isOdd(x);return dt(Ai(K),A)}else return dt(Uint8Array.of(4),A,r.toBytes(x))}function h(_){J(_);let l=r.BYTES,w=l+1,d=2*l+1,x=_.length,A=_[0],K=_.subarray(1);if(x===w&&(A===2||A===3)){let v=r.fromBytes(K);if(!r.isValid(v))throw new Error("bad point: is not on curve, wrong x");let L=m(v),P;try{P=r.sqrt(L)}catch(H){let R=H instanceof Error?": "+H.message:"";throw new Error("bad point: is not on curve, sqrt error"+R)}a();let D=r.isOdd(P);return(A&1)===1!==D&&(P=r.neg(P)),{x:v,y:P}}else if(x===d&&A===4){let v=r.fromBytes(K.subarray(l*0,l*1)),L=r.fromBytes(K.subarray(l*1,l*2));if(!b(v,L))throw new Error("bad point: is not on curve");return{x:v,y:L}}else throw new Error(`bad point: got length ${x}, expected compressed=${w} or uncompressed=${d}`)}let f=t.toBytes||c,u=t.fromBytes||h,m=lf(r,e.a,e.b);function b(_,l){let w=r.sqr(l),d=m(_);return r.eql(w,d)}if(!b(e.Gx,e.Gy))throw new Error("bad curve params: generator point");let g=r.mul(r.pow(e.a,$r),hf),E=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(g,E)))throw new Error("bad curve params: a or b");function y(_,l,w=!1){if(!r.isValid(l)||w&&r.is0(l))throw new Error(`bad point coordinate ${_}`);return l}function S(_){if(!(_ instanceof p))throw new Error("ProjectivePoint expected")}let I=_e((_,l)=>{let{px:w,py:d,pz:x}=_;if(r.eql(x,r.ONE))return{x:w,y:d};let A=_.is0();l==null&&(l=A?r.ONE:r.inv(x));let K=r.mul(w,l),v=r.mul(d,l),L=r.mul(x,l);if(A)return{x:r.ZERO,y:r.ZERO};if(!r.eql(L,r.ONE))throw new Error("invZ was invalid");return{x:K,y:v}}),B=_e(_=>{if(_.is0()){if(t.allowInfinityPoint&&!r.is0(_.py))return;throw new Error("bad point: ZERO")}let{x:l,y:w}=_.toAffine();if(!r.isValid(l)||!r.isValid(w))throw new Error("bad point: x or y not field elements");if(!b(l,w))throw new Error("bad point: equation left != right");if(!_.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function C(_,l,w,d,x){return w=new p(r.mul(w.px,_),w.py,w.pz),l=Ke(d,l),w=Ke(x,w),l.add(w)}class p{constructor(l,w,d){this.px=y("x",l),this.py=y("y",w,!0),this.pz=y("z",d),Object.freeze(this)}static fromAffine(l){let{x:w,y:d}=l||{};if(!l||!r.isValid(w)||!r.isValid(d))throw new Error("invalid affine point");if(l instanceof p)throw new Error("projective point not allowed");return r.is0(w)&&r.is0(d)?p.ZERO:new p(w,d,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(l){return Ur(p,"pz",l)}static fromBytes(l){return J(l),p.fromHex(l)}static fromHex(l){let w=p.fromAffine(u(V("pointHex",l)));return w.assertValidity(),w}static fromPrivateKey(l){let w=Ei(n,t.allowedPrivateKeyLengths,t.wrapPrivateKey);return p.BASE.multiply(w(l))}static msm(l,w){return Dr(p,n,l,w)}precompute(l=8,w=!0){return T.setWindowSize(this,l),w||this.multiply($r),this}_setWindowSize(l){this.precompute(l)}assertValidity(){B(this)}hasEvenY(){let{y:l}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(l)}equals(l){S(l);let{px:w,py:d,pz:x}=this,{px:A,py:K,pz:v}=l,L=r.eql(r.mul(w,v),r.mul(A,x)),P=r.eql(r.mul(d,v),r.mul(K,x));return L&&P}negate(){return new p(this.px,r.neg(this.py),this.pz)}double(){let{a:l,b:w}=e,d=r.mul(w,$r),{px:x,py:A,pz:K}=this,v=r.ZERO,L=r.ZERO,P=r.ZERO,D=r.mul(x,x),Z=r.mul(A,A),H=r.mul(K,K),R=r.mul(x,A);return R=r.add(R,R),P=r.mul(x,K),P=r.add(P,P),v=r.mul(l,P),L=r.mul(d,H),L=r.add(v,L),v=r.sub(Z,L),L=r.add(Z,L),L=r.mul(v,L),v=r.mul(R,v),P=r.mul(d,P),H=r.mul(l,H),R=r.sub(D,H),R=r.mul(l,R),R=r.add(R,P),P=r.add(D,D),D=r.add(P,D),D=r.add(D,H),D=r.mul(D,R),L=r.add(L,D),H=r.mul(A,K),H=r.add(H,H),D=r.mul(H,R),v=r.sub(v,D),P=r.mul(H,Z),P=r.add(P,P),P=r.add(P,P),new p(v,L,P)}add(l){S(l);let{px:w,py:d,pz:x}=this,{px:A,py:K,pz:v}=l,L=r.ZERO,P=r.ZERO,D=r.ZERO,Z=e.a,H=r.mul(e.b,$r),R=r.mul(w,A),$=r.mul(d,K),Y=r.mul(x,v),tt=r.add(w,d),M=r.add(A,K);tt=r.mul(tt,M),M=r.add(R,$),tt=r.sub(tt,M),M=r.add(w,x);let ot=r.add(A,v);return M=r.mul(M,ot),ot=r.add(R,Y),M=r.sub(M,ot),ot=r.add(d,x),L=r.add(K,v),ot=r.mul(ot,L),L=r.add($,Y),ot=r.sub(ot,L),D=r.mul(Z,M),L=r.mul(H,Y),D=r.add(L,D),L=r.sub($,D),D=r.add($,D),P=r.mul(L,D),$=r.add(R,R),$=r.add($,R),Y=r.mul(Z,Y),M=r.mul(H,M),$=r.add($,Y),Y=r.sub(R,Y),Y=r.mul(Z,Y),M=r.add(M,Y),R=r.mul($,M),P=r.add(P,R),R=r.mul(ot,M),L=r.mul(tt,L),L=r.sub(L,R),R=r.mul(tt,$),D=r.mul(ot,D),D=r.add(D,R),new p(L,P,D)}subtract(l){return this.add(l.negate())}is0(){return this.equals(p.ZERO)}multiply(l){let{endo:w}=t;if(!n.isValidNot0(l))throw new Error("invalid scalar: out of range");let d,x,A=K=>T.wNAFCached(this,K,p.normalizeZ);if(w){let{k1neg:K,k1:v,k2neg:L,k2:P}=w.splitScalar(l),{p:D,f:Z}=A(v),{p:H,f:R}=A(P);x=Z.add(R),d=C(w.beta,D,H,K,L)}else{let{p:K,f:v}=A(l);d=K,x=v}return p.normalizeZ([d,x])[0]}multiplyUnsafe(l){let{endo:w}=t,d=this;if(!n.isValid(l))throw new Error("invalid scalar: out of range");if(l===fr||d.is0())return p.ZERO;if(l===ur)return d;if(T.hasPrecomputes(this))return this.multiply(l);if(w){let{k1neg:x,k1:A,k2neg:K,k2:v}=w.splitScalar(l),{p1:L,p2:P}=Ms(p,d,A,v);return C(w.beta,L,P,x,K)}else return T.wNAFCachedUnsafe(d,l)}multiplyAndAddUnsafe(l,w,d){let x=this.multiplyUnsafe(w).add(l.multiplyUnsafe(d));return x.is0()?void 0:x}toAffine(l){return I(this,l)}isTorsionFree(){let{isTorsionFree:l}=t;return o===ur?!0:l?l(p,this):T.wNAFCachedUnsafe(this,s).is0()}clearCofactor(){let{clearCofactor:l}=t;return o===ur?this:l?l(p,this):this.multiplyUnsafe(o)}toBytes(l=!0){return Pt("isCompressed",l),this.assertValidity(),f(p,this,l)}toRawBytes(l=!0){return this.toBytes(l)}toHex(l=!0){return Bt(this.toBytes(l))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}p.BASE=new p(e.Gx,e.Gy,r.ONE),p.ZERO=new p(r.ZERO,r.ONE,r.ZERO),p.Fp=r,p.Fn=n;let U=n.BITS,T=Cr(p,t.endo?Math.ceil(U/2):U);return p}function Ai(e){return Uint8Array.of(e?2:3)}function pf(e,t,r={}){Vt(t,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let n=t.randomBytes||Jt,o=t.hmac||((d,...x)=>cr(t.hash,d,dt(...x))),{Fp:s,Fn:i}=e,{ORDER:a,BITS:c}=i;function h(d){let x=a>>ur;return d>x}function f(d){return h(d)?i.neg(d):d}function u(d,x){if(!i.isValidNot0(x))throw new Error(`invalid signature ${d}: out of range 1..CURVE.n`)}class m{constructor(x,A,K){u("r",x),u("s",A),this.r=x,this.s=A,K!=null&&(this.recovery=K),Object.freeze(this)}static fromCompact(x){let A=i.BYTES,K=V("compactSignature",x,A*2);return new m(i.fromBytes(K.subarray(0,A)),i.fromBytes(K.subarray(A,A*2)))}static fromDER(x){let{r:A,s:K}=Rt.toSig(V("DER",x));return new m(A,K)}assertValidity(){}addRecoveryBit(x){return new m(this.r,this.s,x)}recoverPublicKey(x){let A=s.ORDER,{r:K,s:v,recovery:L}=this;if(L==null||![0,1,2,3].includes(L))throw new Error("recovery id invalid");if(a*uf<A&&L>1)throw new Error("recovery id is ambiguous for h>1 curve");let D=L===2||L===3?K+a:K;if(!s.isValid(D))throw new Error("recovery id 2 or 3 invalid");let Z=s.toBytes(D),H=e.fromHex(dt(Ai((L&1)===0),Z)),R=i.inv(D),$=B(V("msgHash",x)),Y=i.create(-$*R),tt=i.create(v*R),M=e.BASE.multiplyUnsafe(Y).add(H.multiplyUnsafe(tt));if(M.is0())throw new Error("point at infinify");return M.assertValidity(),M}hasHighS(){return h(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,i.neg(this.s),this.recovery):this}toBytes(x){if(x==="compact")return dt(i.toBytes(this.r),i.toBytes(this.s));if(x==="der")return Be(Rt.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Bt(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Bt(this.toBytes("compact"))}}let b=Ei(i,r.allowedPrivateKeyLengths,r.wrapPrivateKey),g={isValidPrivateKey(d){try{return b(d),!0}catch{return!1}},normPrivateKeyToScalar:b,randomPrivateKey:()=>{let d=a;return Ps(n(qn(d)),d)},precompute(d=8,x=e.BASE){return x.precompute(d,!1)}};function E(d,x=!0){return e.fromPrivateKey(d).toBytes(x)}function y(d){if(typeof d=="bigint")return!1;if(d instanceof e)return!0;let A=V("key",d).length,K=s.BYTES,v=K+1,L=2*K+1;if(!(r.allowedPrivateKeyLengths||i.BYTES===v))return A===v||A===L}function S(d,x,A=!0){if(y(d)===!0)throw new Error("first arg must be private key");if(y(x)===!1)throw new Error("second arg must be public key");return e.fromHex(x).multiply(b(d)).toBytes(A)}let I=t.bits2int||function(d){if(d.length>8192)throw new Error("input is too large");let x=ve(d),A=d.length*8-c;return A>0?x>>BigInt(A):x},B=t.bits2int_modN||function(d){return i.create(I(d))},C=ne(c);function p(d){return qt("num < 2^"+c,d,fr,C),i.toBytes(d)}function U(d,x,A=T){if(["recovered","canonical"].some(tt=>tt in A))throw new Error("sign() legacy options not supported");let{hash:K}=t,{lowS:v,prehash:L,extraEntropy:P}=A;v==null&&(v=!0),d=V("msgHash",d),gi(A),L&&(d=V("prehashed msgHash",K(d)));let D=B(d),Z=b(x),H=[p(Z),p(D)];if(P!=null&&P!==!1){let tt=P===!0?n(s.BYTES):P;H.push(V("extraEntropy",tt))}let R=dt(...H),$=D;function Y(tt){let M=I(tt);if(!i.isValidNot0(M))return;let ot=i.inv(M),ke=e.BASE.multiply(M).toAffine(),fe=i.create(ke.x);if(fe===fr)return;let Zt=i.create(ot*i.create($+fe*Z));if(Zt===fr)return;let Qr=(ke.x===fe?0:2)|Number(ke.y&ur),ue=Zt;return v&&h(Zt)&&(ue=f(Zt),Qr^=1),new m(fe,ue,Qr)}return{seed:R,k2sig:Y}}let T={lowS:t.lowS,prehash:!1},_={lowS:t.lowS,prehash:!1};function l(d,x,A=T){let{seed:K,k2sig:v}=U(d,x,A);return Bs(t.hash.outputLen,i.BYTES,o)(K,v)}e.BASE.precompute(8);function w(d,x,A,K=_){let v=d;x=V("msgHash",x),A=V("publicKey",A),gi(K);let{lowS:L,prehash:P,format:D}=K;if("strict"in K)throw new Error("options.strict was renamed to lowS");if(D!==void 0&&!["compact","der","js"].includes(D))throw new Error('format must be "compact", "der" or "js"');let Z=typeof v=="string"||Ee(v),H=!Z&&!D&&typeof v=="object"&&v!==null&&typeof v.r=="bigint"&&typeof v.s=="bigint";if(!Z&&!H)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let R,$;try{if(H)if(D===void 0||D==="js")R=new m(v.r,v.s);else throw new Error("invalid format");if(Z){try{D!=="compact"&&(R=m.fromDER(v))}catch(ue){if(!(ue instanceof Rt.Err))throw ue}!R&&D!=="der"&&(R=m.fromCompact(v))}$=e.fromHex(A)}catch{return!1}if(!R||L&&R.hasHighS())return!1;P&&(x=t.hash(x));let{r:Y,s:tt}=R,M=B(x),ot=i.inv(tt),ke=i.create(M*ot),fe=i.create(Y*ot),Zt=e.BASE.multiplyUnsafe(ke).add($.multiplyUnsafe(fe));return Zt.is0()?!1:i.create(Zt.x)===Y}return Object.freeze({getPublicKey:E,getSharedSecret:S,sign:l,verify:w,utils:g,Point:e,Signature:m})}function mf(e){let t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,n=gt(t.n,e.nBitLength),o={Fp:r,Fn:n,allowedPrivateKeyLengths:e.allowedPrivateKeyLengths,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,wrapPrivateKey:e.wrapPrivateKey,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes};return{CURVE:t,curveOpts:o}}function yf(e){let{CURVE:t,curveOpts:r}=mf(e),n={hash:e.hash,hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:t,curveOpts:r,ecdsaOpts:n}}function bf(e,t){return Object.assign({},t,{ProjectivePoint:t.Point,CURVE:e})}function Si(e){let{CURVE:t,curveOpts:r,ecdsaOpts:n}=yf(e),o=df(t,r),s=pf(o,n,r);return bf(e,s)}function Bi(e,t){let r=n=>Si({...e,hash:n});return{...r(t),create:r}}var Yr={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},T0=BigInt(0),xf=BigInt(1),xo=BigInt(2),vi=(e,t)=>(e+t/xo)/t;function wf(e){let t=Yr.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),h=e*e*e%t,f=h*h*e%t,u=z(f,r,t)*f%t,m=z(u,r,t)*f%t,b=z(m,xo,t)*h%t,g=z(b,o,t)*b%t,E=z(g,s,t)*g%t,y=z(E,a,t)*E%t,S=z(y,c,t)*y%t,I=z(S,a,t)*E%t,B=z(I,r,t)*f%t,C=z(B,i,t)*g%t,p=z(C,n,t)*h%t,U=z(p,xo,t);if(!wo.eql(wo.sqr(U),e))throw new Error("Cannot find square root");return U}var wo=gt(Yr.p,void 0,void 0,{sqrt:wf}),At=Bi({...Yr,Fp:wo,lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=Yr.n,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-xf*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,i=BigInt("0x100000000000000000000000000000000"),a=vi(s*e,t),c=vi(-n*e,t),h=j(e-a*r-c*o,t),f=j(-a*n-c*s,t),u=h>i,m=f>i;if(u&&(h=t-h),m&&(f=t-f),h>i||f>i)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:u,k1:h,k2neg:m,k2:f}}}},Kr);var Ii=33,_i=32;function Ki(e,t,r){let n=xr.digest(t instanceof Uint8Array?t:t.subarray());if(Ce(n))return n.then(({digest:o})=>(r?.signal?.throwIfAborted(),At.sign(o,e).toDERRawBytes())).catch(o=>{throw o.name==="AbortError"?o:new He(String(o))});try{return At.sign(n.digest,e).toDERRawBytes()}catch(o){throw new He(String(o))}}function Li(e,t,r,n){let o=xr.digest(r instanceof Uint8Array?r:r.subarray());if(Ce(o))return o.then(({digest:s})=>(n?.signal?.throwIfAborted(),At.verify(t,s,e))).catch(s=>{throw s.name==="AbortError"?s:new Oe(String(s))});try{return n?.signal?.throwIfAborted(),At.verify(t,o.digest,e)}catch(s){throw new Oe(String(s))}}var hr=class{type="secp256k1";raw;_key;constructor(t){this._key=Ci(t),this.raw=Ti(this._key)}toMultihash(){return $t.digest(Wt(this))}toCID(){return yt.createV1(114,this.toMultihash())}toString(){return W.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:rt(this.raw,t.raw)}verify(t,r,n){return Li(this._key,r,t,n)}},lr=class{type="secp256k1";raw;publicKey;constructor(t,r){this.raw=Ui(t),this.publicKey=new hr(r??Di(t))}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:rt(this.raw,t.raw)}sign(t,r){return Ki(this.raw,t,r)}};function go(e){return new lr(e)}function Wr(e){return new hr(e)}async function Pi(){let e=gf();return new lr(e)}function Ti(e){return At.ProjectivePoint.fromHex(e).toRawBytes(!0)}function Ui(e){try{return At.getPublicKey(e,!0),e}catch(t){throw new Me(String(t))}}function Ci(e){try{return At.ProjectivePoint.fromHex(e),e}catch(t){throw new he(String(t))}}function Di(e){try{return At.getPublicKey(e,!0)}catch(t){throw new Me(String(t))}}function gf(){return At.utils.randomPrivateKey()}var Xr={"P-256":32,"P-384":48,"P-521":66},Ef=Object.keys(Xr),Eo=Ef.join(" / ");async function Ri(e){if(e!=="P-256"&&e!=="P-384"&&e!=="P-521")throw new N(`Unknown curve: ${e}. Must be ${Eo}`);let t=await F.get().subtle.generateKey({name:"ECDH",namedCurve:e},!0,["deriveBits"]),r=async(s,i)=>{let a;i!=null?a=await F.get().subtle.importKey("jwk",Sf(e,i),{name:"ECDH",namedCurve:e},!1,["deriveBits"]):a=t.privateKey;let c=await F.get().subtle.importKey("jwk",Ni(e,s),{name:"ECDH",namedCurve:e},!1,[]),h=await F.get().subtle.deriveBits({name:"ECDH",public:c},a,Xr[e]*8);return new Uint8Array(h,0,h.byteLength)},n=await F.get().subtle.exportKey("jwk",t.publicKey);return{key:Af(n),genSharedKey:r}}function Af(e){if(e.crv==null||e.x==null||e.y==null)throw new N("JWK was missing components");if(e.crv!=="P-256"&&e.crv!=="P-384"&&e.crv!=="P-521")throw new N(`Unknown curve: ${e.crv}. Must be ${Eo}`);let t=Xr[e.crv];return St([Uint8Array.from([4]),Gn(e.x,t),Gn(e.y,t)],1+t*2)}function Ni(e,t){if(e!=="P-256"&&e!=="P-384"&&e!=="P-521")throw new N(`Unknown curve: ${e}. Must be ${Eo}`);let r=Xr[e];if(!rt(t.subarray(0,1),Uint8Array.from([4])))throw new N("Cannot unmarshal public key - invalid key format");return{kty:"EC",crv:e,x:k(t.subarray(1,r+1),"base64url"),y:k(t.subarray(1+r),"base64url"),ext:!0}}var Sf=(e,t)=>({...Ni(e,t.public),d:k(t.private,"base64url")});var Bf={"AES-128":{ivSize:16,keySize:16},"AES-256":{ivSize:16,keySize:32},Blowfish:{ivSize:8,keySize:32}};async function ki(e,t,r){if(e!=="AES-128"&&e!=="AES-256"&&e!=="Blowfish")throw new N("Cipher type was missing or unsupported");if(t!=="SHA1"&&t!=="SHA256"&&t!=="SHA512")throw new N("Hash type was missing or unsupported");if(r==null||!(r instanceof Uint8Array))throw new N("Secret was missing or an incorrect type");let n=Bf[e],o=n.keySize,s=n.ivSize,i=20,a=q("key expansion"),c=2*(s+o+i),h=await en(t,r),f=await h.digest(a),u=[],m=0;for(;m<c;){let I=await h.digest(St([f,a])),B=I.length;m+B>c&&(B=c-m),u.push(I),m+=B,f=await h.digest(f)}let b=c/2,g=St(u),E=g.subarray(0,b),y=g.subarray(b,c),S=I=>({iv:I.subarray(0,s),cipherKey:I.subarray(s,s+o),macKey:I.subarray(s+o)});return{k1:S(E),k2:S(y)}}async function vf(e,t){if(e==="Ed25519")return Xs();if(e==="secp256k1")return Pi();if(e==="RSA")return yo(Df(t));if(e==="ECDSA")return as(Pf(t));throw new Nt}async function If(e,t){if(e!=="Ed25519")throw new Nt("Seed key derivation only supported for Ed25519 keys");return Js(t)}function _f(e,t){let{Type:r,Data:n}=_t.decode(e),o=n??new Uint8Array;switch(r){case O.RSA:return mo(o,t);case O.Ed25519:return kr(o);case O.secp256k1:return Wr(o);case O.ECDSA:return Un(o);default:throw new Nt}}function Kf(e){if(e.byteLength===zt)return kr(e);if(e.byteLength===Ii)return Wr(e);let t=lt(e),r=t[1]?.[0];if(r===_n||r===Kn||r===Ln)return Cn(t);if(t[0]?.[0]===wi)return jr(t,e);throw new N("Could not extract public key from raw bytes")}function Lf(e){let{Type:t,Data:r}=_t.decode(e.digest),n=r??new Uint8Array;switch(t){case O.Ed25519:return kr(n);case O.secp256k1:return Wr(n);case O.ECDSA:return Un(n);default:throw new Nt}}function Wt(e){return _t.encode({Type:O[e.type],Data:e.raw})}function Tf(e){let t=sr.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case O.RSA:return po(r);case O.Ed25519:return Zn(r);case O.secp256k1:return go(r);case O.ECDSA:return ns(r);default:throw new Nt}}function Uf(e){if(e.byteLength===pt)return Zn(e);if(e.byteLength===_i)return go(e);let t=lt(e),r=t[2]?.[0];if(r===_n||r===Kn||r===Ln)return Tn(t);if(t.length>8)return Fr(t);throw new N("Could not extract private key from raw bytes")}function Cf(e){return sr.encode({Type:O[e.type],Data:e.raw})}function Df(e){return e==null?2048:parseInt(e,10)}function Pf(e){if(e==="P-256"||e==null)return"P-256";if(e==="P-384")return"P-384";if(e==="P-521")return"P-521";throw new N("Unsupported curve, should be P-256, P-384 or P-521")}async function Rf(e){if(e.type==="RSA")return{privateKey:await crypto.subtle.importKey("jwk",e.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",e.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(e.type==="ECDSA")return{privateKey:await crypto.subtle.importKey("jwk",e.jwk,{name:"ECDSA",namedCurve:e.jwk.crv??"P-256"},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",e.publicKey.jwk,{name:"ECDSA",namedCurve:e.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new N("Only RSA and ECDSA keys are supported")}async function Nf(e){if(e.privateKey.algorithm.name==="RSASSA-PKCS1-v1_5"){let t=await crypto.subtle.exportKey("jwk",e.privateKey);return Gr(t)}if(e.privateKey.algorithm.name==="ECDSA"){let t=await crypto.subtle.exportKey("jwk",e.privateKey);return new Tt(t)}throw new N("Only RSA and ECDSA keys are supported")}function kf(e,t,r,n){Er(e);let o=hs({dkLen:32,asyncTick:10},n),{c:s,dkLen:i,asyncTick:a}=o;if(Ct(s),Ct(i),Ct(a),s<1)throw new Error("iterations (c) should be >= 1");let c=Pn(t),h=Pn(r),f=new Uint8Array(i),u=cr.create(e,c),m=u._cloneInto().update(h);return{c:s,dkLen:i,asyncTick:a,DK:f,PRF:u,PRFSalt:m}}function Hf(e,t,r,n,o){return e.destroy(),t.destroy(),n&&n.destroy(),ut(o),r}function Hi(e,t,r,n){let{c:o,dkLen:s,DK:i,PRF:a,PRFSalt:c}=kf(e,t,r,n),h,f=new Uint8Array(4),u=Se(f),m=new Uint8Array(a.outputLen);for(let b=1,g=0;g<s;b++,g+=a.outputLen){let E=i.subarray(g,g+a.outputLen);u.setInt32(0,b,!1),(h=c._cloneInto(h)).update(f).digestInto(m),E.set(m.subarray(0,E.length));for(let y=1;y<o;y++){a._cloneInto(h).update(m).digestInto(m);for(let S=0;S<E.length;S++)E[S]^=m[S]}}return Hf(a,c,i,h,m)}var dr=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),Gt=new Uint32Array(80),Jr=class extends Qt{constructor(){super(64,20,8,!1),this.A=dr[0]|0,this.B=dr[1]|0,this.C=dr[2]|0,this.D=dr[3]|0,this.E=dr[4]|0}get(){let{A:t,B:r,C:n,D:o,E:s}=this;return[t,r,n,o,s]}set(t,r,n,o,s){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0}process(t,r){for(let c=0;c<16;c++,r+=4)Gt[c]=t.getUint32(r,!1);for(let c=16;c<80;c++)Gt[c]=Ar(Gt[c-3]^Gt[c-8]^Gt[c-14]^Gt[c-16],1);let{A:n,B:o,C:s,D:i,E:a}=this;for(let c=0;c<80;c++){let h,f;c<20?(h=Sr(o,s,i),f=1518500249):c<40?(h=o^s^i,f=1859775393):c<60?(h=Br(o,s,i),f=2400959708):(h=o^s^i,f=3395469782);let u=Ar(n,5)+h+a+f+Gt[c]|0;a=i,i=s,s=Ar(o,30),o=n,n=u}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,this.set(n,o,s,i,a)}roundClean(){ut(Gt)}destroy(){this.set(0,0,0,0,0),ut(this.buffer)}},Oi=We(()=>new Jr);var Mi=Oi;var qi=Lr;var Vi={sha1:Mi,"sha2-256":Re,"sha2-512":qi};function So(e,t,r,n,o){if(o!=="sha1"&&o!=="sha2-256"&&o!=="sha2-512"){let a=Object.keys(Vi).join(" / ");throw new N(`Hash '${o}' is unknown or not supported. Must be ${a}`)}let s=Vi[o],i=Hi(s,e,t,{c:r,dkLen:n});return bn.encode(i).substring(1)}return Zi(Of);})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/edwards.js:
@noble/curves/esm/ed25519.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/_shortw_utils.js:
@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
return Libp2PCrypto}));
//# sourceMappingURL=index.min.js.map
